#!/usr/bin/env python3

import sys
import os
import argparse
from cobblelib.cli import execute, parse_query

def cli(args):
    parser = argparse.ArgumentParser()
    parser.add_argument('query', nargs=1, help='Query to run')
    parser.add_argument('--dry-run', action="store_true", help='Parse and validate query without running')
    parsed_arguments = parser.parse_args(args)

    query = parsed_arguments.query[0]
    if os.path.exists(query):
        with open(query) as f:
            query = f.read()

    if parsed_arguments.dry_run:
        parse_query(query)
    else:
        execute(query)

if __name__ == '__main__':
    cli(sys.argv[1:])
