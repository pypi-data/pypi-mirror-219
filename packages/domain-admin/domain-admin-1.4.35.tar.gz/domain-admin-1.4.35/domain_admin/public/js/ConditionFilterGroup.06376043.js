import{d as O}from"./element-plus.c20bc0dd.js";import{_ as C}from"./index.2bdf1435.js";import{o as d,c as m,J as I,U as b,ah as l,V as n,P as o,a as c,T as k,O as w,S as x,ar as E,Q as F,F as v,a8 as T,L as A}from"./vendor-vue.9e61e0af.js";const U={name:"ExpireDays",props:{value:{type:[Number,String],default:null}},components:{},data(){return{}},computed:{showValue(){return Number.isInteger(this.value)},className(){return this.showValue?this.value<7?["color--danger"]:this.value<30?["color--warning"]:["color--success"]:[]}},methods:{async getData(){}},created(){this.getData()}},M={class:"ExpireDays"},z={key:1};function N(s,t,e,f,a,i){return d(),m("div",M,[i.showValue?(d(),m("span",{key:0,class:I(i.className)},b(e.value),3)):(d(),m("span",z,"-"))])}const P=C(U,[["render",N]]),K={host:[{message:"\u4E3B\u673A\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],host_connect_status:[{message:"\u4E3B\u673A\u8FDE\u63A5\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],host_check_time:[{message:"\u4E3B\u673A\u68C0\u67E5\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},j={name:"",props:{row:{type:Object,default:null},domainId:{type:Number,default:null}},components:{},data(){return{rules:K,is_auto_update:!0,form:{host:"",host_connect_status:"",host_check_time:"",ssl_start_time:"",ssl_expire_time:"",ssl_check_time:"",ssl_expire_days:"",ssl_expire_monitor:!0,ssl_auto_update:!0}}},computed:{disabledTime(){return this.is_auto_update}},methods:{async getDomainById(){let s={domain_id:this.domainId};const t=await this.$http.getDomainById(s);t.ok&&(this.is_auto_update=t.data.auto_update)},async getData(){if(await this.getDomainById(),this.row){let s={address_id:this.row.id};const t=await this.$http.getAddressById(s);if(t.code!=0)return;let e=t.data;this.form.host=e.host,this.form.host_connect_status=e.host_connect_status,this.form.host_check_time=e.host_check_time,this.form.ssl_start_time=e.ssl_start_time,this.form.ssl_expire_time=e.ssl_expire_time,this.form.ssl_check_time=e.ssl_check_time,this.form.ssl_expire_days=e.ssl_expire_days,this.form.ssl_auto_update=e.ssl_auto_update,this.form.ssl_expire_monitor=e.ssl_expire_monitor}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(s=>{if(s)this.confirmSubmit();else return!1})},async confirmSubmit(){let s=this.$loading({fullscreen:!0}),t={domain_id:this.domainId,host:this.form.host.trim(),ssl_start_time:this.form.ssl_start_time,ssl_expire_time:this.form.ssl_expire_time},e=null;this.row?(t.address_id=this.row.id,e=await this.$http.updateAddressById(t)):e=await this.$http.addAddress(t),e.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(e.msg),this.$nextTick(()=>{s.close()})}},created(){this.getData()}},Y={class:"text-center mt-md"};function H(s,t,e,f,a,i){const r=l("el-input"),_=l("el-form-item"),p=l("el-date-picker"),h=l("el-form"),g=l("el-button");return d(),m("div",null,[n(h,{ref:"form",model:a.form,rules:a.rules,"label-width":"100px"},{default:o(()=>[n(_,{label:"\u4E3B\u673AIP\u5730\u5740",prop:"host"},{default:o(()=>[n(r,{type:"text",style:{width:"220px"},modelValue:a.form.host,"onUpdate:modelValue":t[0]||(t[0]=y=>a.form.host=y),placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673A\u5730\u5740"},null,8,["modelValue"])]),_:1}),n(_,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"ssl_start_time"},{default:o(()=>[n(p,{modelValue:a.form.ssl_start_time,"onUpdate:modelValue":t[1]||(t[1]=y=>a.form.ssl_start_time=y),type:"date","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",teleported:!1,disabled:i.disabledTime},null,8,["modelValue","disabled"])]),_:1}),n(_,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",prop:"ssl_expire_time"},{default:o(()=>[n(p,{modelValue:a.form.ssl_expire_time,"onUpdate:modelValue":t[2]||(t[2]=y=>a.form.ssl_expire_time=y),type:"date","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",teleported:!1,disabled:i.disabledTime},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules"]),c("div",Y,[n(g,{onClick:i.handleCancel},{default:o(()=>[k("\u53D6 \u6D88")]),_:1},8,["onClick"]),n(g,{type:"primary",onClick:i.handleSubmit},{default:o(()=>[k("\u786E \u5B9A")]),_:1},8,["onClick"])])])}const L=C(j,[["render",H]]),G={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1},domainId:{type:Number,default:null}},emits:["update:visible"],components:{DataForm:L},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91\u4E3B\u673A\u5730\u5740":"\u6DFB\u52A0\u4E3B\u673A\u5730\u5740"},dialogVisible:{get(){return this.visible},set(s){this.$emit("update:visible",s)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function q(s,t,e,f,a,i){const r=l("DataForm"),_=l("el-dialog");return d(),w(_,{title:i.dialogTitle,modelValue:i.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=p=>i.dialogVisible=p),width:"400px",center:"","append-to-body":""},{default:o(()=>[i.dialogVisible?(d(),w(r,{key:0,row:e.row,domainId:e.domainId,onOnCancel:i.handleClose,onOnSuccess:i.handleSuccess},null,8,["row","domainId","onOnCancel","onOnSuccess"])):x("",!0)]),_:1},8,["title","modelValue"])}const $=C(G,[["render",q]]),J={name:"",components:{DataFormDialog:$,ExpireDays:P},props:{list:{type:Array},domainId:{type:Number,default:null},domainRow:{type:Object,default:null},disableUpdateButton:{type:Boolean,default:!1}},emits:["on-selection-change"],computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(s){this.currentRow=s,this.dialogVisible=!0},async handleDeleteClick(s){let t={address_id:s.id};const e=await this.$http.deleteAddressById(t);e.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(e.msg)},async handleStatusChange(s){let t={id:s.id};const e=await this.$http.function(t);e.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(e.msg)},handleUpdateSuccess(){this.$emit("on-success")},async handleUpdateRowDomainInfo(s){let t=this.$loading({fullscreen:!0}),e={address_id:s.id};const f=await this.$http.updateAddressRowInfoById(e);f.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(f.msg),this.$nextTick(()=>{t.close()})}},created(){}};function Q(s,t,e,f,a,i){const r=l("el-table-column"),_=l("ExpireDays"),p=l("Refresh"),h=l("el-icon"),g=l("el-link"),y=l("Edit"),S=l("Delete"),V=l("el-popconfirm"),R=l("el-table"),B=l("DataFormDialog");return d(),m("div",null,[n(R,{data:e.list,stripe:"",border:"",onSelectionChange:t[0]||(t[0]=u=>s.$emit("on-selection-change",u))},{default:o(()=>[e.domainRow.has_edit_permission?(d(),w(r,{key:0,type:"selection","header-align":"center",align:"center",width:"40"})):x("",!0),n(r,{label:"\u4E3B\u673AIP\u5730\u5740","header-align":"center",align:"center",prop:"host"},{default:o(u=>[c("span",null,b(u.row.host||"-"),1)]),_:1}),n(r,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4","header-align":"center",align:"center",prop:"ssl_start_time"},{default:o(u=>[c("span",null,b(u.row.ssl_start_date||"-"),1)]),_:1}),n(r,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4","header-align":"center",align:"center",prop:"ssl_expire_time"},{default:o(u=>[c("span",null,b(u.row.ssl_expire_date||"-"),1)]),_:1}),n(r,{label:"\u8BC1\u4E66\u5269\u4F59\u5929\u6570","header-align":"center",align:"center",prop:"ssl_expire_days"},{default:o(u=>[n(_,{value:u.row.real_time_ssl_expire_days},null,8,["value"])]),_:1}),n(r,{label:"\u8BC1\u4E66\u68C0\u67E5\u65F6\u95F4","header-align":"center",align:"center",prop:"ssl_check_time"},{default:o(u=>[c("span",null,b(u.row.update_time_label||"-"),1)]),_:1}),n(r,{label:"\u64CD\u4F5C",width:"90",align:"center",prop:"tag"},{default:o(u=>[n(g,{underline:!1,type:"primary",class:"mr-sm",disabled:e.disableUpdateButton,onClick:D=>i.handleUpdateRowDomainInfo(u.row)},{default:o(()=>[n(h,null,{default:o(()=>[n(p)]),_:1})]),_:2},1032,["disabled","onClick"]),n(g,{underline:!1,type:"primary",class:"mr-sm",onClick:D=>i.handleEditRow(u.row),disabled:!e.domainRow.has_edit_permission},{default:o(()=>[n(h,null,{default:o(()=>[n(y)]),_:1})]),_:2},1032,["onClick","disabled"]),n(V,{title:"\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:D=>i.handleDeleteClick(u.row),disabled:!e.domainRow.has_edit_permission},{reference:o(()=>[n(g,{underline:!1,type:"danger",disabled:!e.domainRow.has_edit_permission},{default:o(()=>[n(h,null,{default:o(()=>[n(S)]),_:1})]),_:1},8,["disabled"])]),_:2},1032,["onConfirm","disabled"])]),_:1})]),_:1},8,["data"]),n(B,{visible:a.dialogVisible,"onUpdate:visible":t[1]||(t[1]=u=>a.dialogVisible=u),row:a.currentRow,domainId:e.domainId,onOnSuccess:i.handleUpdateSuccess},null,8,["visible","row","domainId","onOnSuccess"])])}const W=C(J,[["render",Q]]),X={name:"address-list",props:{domainRow:{type:Object,default:null},domainId:{type:Number,default:null}},components:{DataFormDialog:$,DataTable:W},data(){return{list:[],total:0,page:1,size:10,keyword:"",selectedRows:[],loading:!0,dialogVisible:!1,is_auto_update:!0}},computed:{disableUpdateButton(){return!this.is_auto_update},showBatchDeleteButton(){return!!(this.selectedRows&&this.selectedRows.length>0)}},methods:{async resetData(){this.page=1,await this.getData()},async getDomainById(){let s={domain_id:this.domainId};const t=await this.$http.getDomainById(s);t.ok&&(this.is_auto_update=t.data.auto_update)},async getData(){this.loading=!0;let s={domain_id:this.domainId,page:this.page,size:this.size};try{const t=await this.$http.getAddressListByDomainId(s);t.code==0&&(this.list=t.data.list,this.total=t.data.total)}catch(t){console.log(t)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()},async updateAllAddress(){let s=this.$loading({fullscreen:!0}),t={domain_id:this.domainId},e=await this.$http.updateAddressListInfoByDomainId(t);e.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData()):this.$msg.error(e.msg),this.$nextTick(()=>{s.close()})},handleSizeChange(s){this.resetData()},handleSelectionChange(s){this.selectedRows=s},async handleBatchDeleteConfirm(){let s=this.$loading({fullscreen:!0}),t={address_ids:this.selectedRows.map(e=>e.id)};try{(await this.$http.deleteAddressByIds(t)).ok&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData())}catch(e){console.log(e)}finally{this.$nextTick(()=>{s.close()})}}},created(){this.resetData()}},Z={class:""},ee={class:"flex justify-between items-center"};function te(s,t,e,f,a,i){const r=l("Plus"),_=l("el-icon"),p=l("el-button"),h=l("Delete"),g=l("el-link"),y=l("el-popconfirm"),S=l("Refresh"),V=l("DataTable"),R=l("el-pagination"),B=l("DataFormDialog"),u=E("loading");return d(),m("div",Z,[c("div",ee,[n(p,{type:"primary",onClick:i.handleAddRow,disabled:!e.domainRow.has_edit_permission},{default:o(()=>[n(_,null,{default:o(()=>[n(r)]),_:1}),k("\u6DFB\u52A0")]),_:1},8,["onClick","disabled"]),c("div",null,[i.showBatchDeleteButton?(d(),w(y,{key:0,title:"\u786E\u5B9A\u5220\u9664\u9009\u4E2D\uFF1F",onConfirm:i.handleBatchDeleteConfirm},{reference:o(()=>[n(g,{underline:!1,type:"danger",class:"mr-sm"},{default:o(()=>[n(_,null,{default:o(()=>[n(h)]),_:1}),k("\u6279\u91CF\u5220\u9664")]),_:1})]),_:1},8,["onConfirm"])):x("",!0),n(g,{underline:!1,type:"primary",disabled:i.disableUpdateButton,onClick:i.updateAllAddress},{default:o(()=>[n(_,null,{default:o(()=>[n(S)]),_:1}),k("\u5168\u90E8\u66F4\u65B0")]),_:1},8,["disabled","onClick"])])]),F(n(V,{class:"mt-md",list:a.list,domainId:e.domainId,domainRow:e.domainRow,disableUpdateButton:i.disableUpdateButton,onOnSuccess:i.resetData,onOnSelectionChange:i.handleSelectionChange},null,8,["list","domainId","domainRow","disableUpdateButton","onOnSuccess","onOnSelectionChange"]),[[u,a.loading]]),n(R,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:a.total,"page-size":a.size,"onUpdate:pageSize":t[0]||(t[0]=D=>a.size=D),"current-page":a.page,"onUpdate:currentPage":t[1]||(t[1]=D=>a.page=D),onCurrentChange:i.getData,onSizeChange:i.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),n(B,{visible:a.dialogVisible,"onUpdate:visible":t[2]||(t[2]=D=>a.dialogVisible=D),domainId:e.domainId,onOnSuccess:i.handleAddSuccess},null,8,["visible","domainId","onOnSuccess"])])}const se=C(X,[["render",te]]);const ie={name:"ExpireProgress",props:{startTime:{type:String},endTime:{type:String},isManual:{type:Boolean}},components:{},data(){return{nowTime:O()}},computed:{parsedStartTime(){return O(this.startTime)},parsedEndTime(){return O(this.endTime)},totalDays(){return this.parsedEndTime.diff(this.parsedStartTime,"day")},expireDays(){return this.parsedEndTime.diff(this.nowTime,"day")},percentage(){let s=null;return this.expireDays&&this.totalDays&&(s=this.expireDays/this.totalDays*100),s},percentageStatus(){let s;return this.expireDays>7?s="":this.expireDays>0?s="warning":s="exception",s}},methods:{async getData(){}},created(){this.getData()}},ne={class:"ExpireProgress"},le={class:"ExpireProgress__info"},ae={class:"el-text-color-primary"},oe=c("span",null," / ",-1),de={class:"el-text-color-secondary"},re={key:1};function ce(s,t,e,f,a,i){const r=l("el-progress");return d(),m("div",ne,[i.percentage?(d(),w(r,{key:0,percentage:i.percentage,"show-text":!1,status:i.percentageStatus},null,8,["percentage","status"])):x("",!0),c("div",le,[i.totalDays?(d(),m(v,{key:0},[c("span",ae,b(i.expireDays),1),oe,c("span",de,b(i.totalDays),1)],64)):(d(),m("span",re,"-"))])])}const Oe=C(ie,[["render",ce]]),ue={name:"",props:{domainRow:{type:Object,default:null},row:{type:Object,default:null},visible:{type:Boolean,default:!1},domainId:{type:Number,default:null}},components:{DataTableIndex:se},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(s){this.$emit("update:visible",s)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose(),this.$emit("on-success")},handleDialogClose(){this.$emit("on-close")}},created(){}};function _e(s,t,e,f,a,i){const r=l("DataTableIndex"),_=l("el-dialog");return d(),w(_,{title:"\u57DF\u540D\u4E3B\u673A\u5217\u8868",modelValue:i.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=p=>i.dialogVisible=p),width:"900px",center:"","append-to-body":"",onClose:i.handleDialogClose},{default:o(()=>[i.dialogVisible?(d(),w(r,{key:0,row:e.row,domainRow:e.domainRow,domainId:e.domainId,onOnCancel:i.handleClose,onOnSuccess:i.handleSuccess},null,8,["row","domainRow","domainId","onOnCancel","onOnSuccess"])):x("",!0)]),_:1},8,["modelValue","onClose"])}const Te=C(ue,[["render",_e]]);const he={name:"ConditionFilter",props:{title:{type:String},field:{type:String},options:{type:Array},selected:{type:Array,default:()=>[]},maxCount:{type:Number,default:0},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},level:{type:Number,default:0}},components:{},data(){return{childrenKey:0,showMoreButton:!1,hiddenMore:!0,itemTagHeight:20}},computed:{selectedIsEmpty(){return this.selected.length==0}},methods:{async getData(){},handleClear(){this.selected.splice(0,this.selected.length),this.handleChange()},handleClick(s){let t=this.selected.findIndex(e=>s[this.valueKey]==e);t>-1?this.selected.splice(t,1):(this.maxCount==1&&this.selected.splice(0,this.selected.length),this.selected.push(s[this.valueKey])),this.childrenKey++,this.handleChange()},handleChange(){this.$emit("on-change",{selected:this.selected,title:this.title,field:this.field,options:this.options})},handleChildrenChange(s){this.$emit("on-change",s)},handleMoreClick(){this.hiddenMore=!this.hiddenMore},handleWindowResize(){!this.$refs["condition-item__list"]||(this.$refs["condition-item__list"].clientHeight>this.itemTagHeight?(this.showMoreButton=!0,this.selected&&this.selected.length>0?this.hiddenMore=!1:this.hiddenMore=!0):(this.hiddenMore=!1,this.showMoreButton=!1))}},mounted(){},created(){this.getData()}},me={class:"condition-filter"},pe={key:0,class:"condition-filter__title"},fe={class:"condition-filter__group_button"},ge={class:"condition-filter__list-wrap"},ye={class:"condition-item__list-box"},be={class:"condition-item__list",ref:"condition-item__list"},we=["onClick"],Ce={class:"condition-filter__tag__close"},De={class:"condition-filter__children"};function xe(s,t,e,f,a,i){const r=l("Close"),_=l("el-icon"),p=l("ConditionFilter");return d(),m("div",me,[e.title?(d(),m("div",pe,b(e.title),1)):x("",!0),c("div",fe,[c("div",{class:I(["condition-filter__tag condition-filter__clear",{"condition-filter__tag--seleted":i.selectedIsEmpty}]),onClick:t[0]||(t[0]=(...h)=>i.handleClear&&i.handleClear(...h))}," \u4E0D\u9650 ",2),c("div",ge,[c("div",ye,[c("div",{class:I({"condition-item__list--overflow":a.hiddenMore})},[c("div",be,[(d(!0),m(v,null,T(e.options,h=>(d(),m("div",{class:I(["condition-filter__tag",{"condition-filter__tag--seleted":e.selected.indexOf(h[e.valueKey])>-1}]),onClick:g=>i.handleClick(h)},[c("span",null,b(h[e.labelKey]),1),c("span",Ce,[n(_,null,{default:o(()=>[n(r)]),_:1})])],10,we))),256))],512)],2)]),c("div",De,[(d(!0),m(v,null,T(e.options,h=>(d(),m(v,null,[e.selected.indexOf(h[e.valueKey])>-1&&h.child?(d(),w(p,A({key:a.childrenKey,class:"condition-filter__child",ref_for:!0,ref:"child"},h.child,{level:h.level||e.level+1,onOnChange:i.handleChildrenChange}),null,16,["level","onOnChange"])):x("",!0)],64))),256))])])])])}const ve=C(he,[["render",xe]]);const ke={name:"ConditionFilterGroup",props:{options:{type:Array}},components:{ConditionFilterRow:ve},data(){return{}},computed:{},methods:{async getData(){},handleChange(s){console.log(s),this.$emit("on-change",s)}},created(){this.getData()}},Ie={class:"ConditionFilterGroup"};function Se(s,t,e,f,a,i){const r=l("ConditionFilterRow");return d(),m("div",Ie,[(d(!0),m(v,null,T(e.options,_=>(d(),m(v,null,[_.hidden?x("",!0):(d(),w(r,A({key:0,class:"ConditionFilterGroup__row"},_,{onOnChange:i.handleChange}),null,16,["onOnChange"]))],64))),256))])}const Ae=C(ke,[["render",Se]]);export{se as A,Ae as C,P as E,Oe as a,Te as b};
