"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_contexts_pageError_tsx-app_views_starfish_views_spans_spansView_tsx"],{"./app/utils/performance/contexts/pageError.tsx":(e,t,s)=>{s.d(t,{De:()=>l,V_:()=>o,YY:()=>p});var a=s("../node_modules/react/index.js"),r=s("./app/components/alert.tsx"),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,a.createContext)({pageError:void 0,setPageError:e=>{}});function o(e){let{children:t}=e;const[s,r]=(0,a.useState)();return(0,n.tZ)(i.Provider,{value:{pageError:s,setPageError:r},children:t})}function p(){const{pageError:e}=(0,a.useContext)(i);return e?(0,n.tZ)(r.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}o.displayName="PageErrorProvider",p.displayName="PageErrorAlert";const l=()=>(0,a.useContext)(i)},"./app/views/starfish/components/chartPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>p});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/react/index.js"),s("./app/components/panels/panel.tsx")),n=s("./app/components/panels/panelBody.tsx"),i=s("./app/styles/space.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{title:t,children:s,button:a}=e;return(0,o.tZ)(r.Z,{children:(0,o.BX)(n.Z,{withPadding:!0,children:[t&&(0,o.BX)(u,{children:[t&&(0,o.tZ)(l,{children:t}),a]}),s]})})}p.displayName="ChartPanel";const l=(0,a.Z)("p",{target:"e1tvnfsq1"})((e=>e.theme.text.cardTitle),";"),u=(0,a.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,i.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/components/starfishProjectSelector.tsx":(e,t,s)=>{s.d(t,{Z:()=>m}),s("../node_modules/core-js/modules/es.error.cause.js");var a=s("./app/actionCreators/pageFilters.tsx"),r=s("./app/components/compactSelect/index.tsx"),n=s("./app/components/idBadge/projectBadge.tsx"),i=s("./app/locale.tsx"),o=s("./app/utils/useOrganization.tsx"),p=s("./app/utils/usePageFilters.tsx"),l=s("./app/utils/useProjects.tsx"),u=s("./app/utils/useRouter.tsx");const d={sentry:["1","300688"],codecov:["5215654"],peated:["4505138082349056"]};var c=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(){const{projects:e,initiallyLoaded:t,fetchError:s}=(0,l.Z)(),n=(0,o.Z)(),{selection:m,isReady:f}=(0,p.Z)(),g=(0,u.Z)();if(!t||!f)return(0,c.tZ)(r.Z,{disabled:!0,options:[{label:(0,i.t)("Loadingâ€¦"),value:"loading"}],defaultValue:"loading"});if(s)throw new Error("Failed to fetch projects");const y=d[n.slug]??[],v=e.filter((e=>y.includes(e.id))).map((e=>({label:(0,c.tZ)(h,{project:e}),value:e.id}))),_=v.find((e=>m.projects.includes(parseInt(e.value,10))))??v[0],x=e=>(0,a.id)([parseInt(e.value,10)],g,{save:!0});return(m.projects.length>1||!y.includes(`${m.projects[0]}`))&&x(v[0]),(0,c.tZ)(r.Z,{menuWidth:250,options:v,defaultValue:_?.value,onChange:x})}function h(e){let{project:t}=e;return(0,c.tZ)(n.Z,{project:t,avatarSize:20,disableLink:!0})}m.displayName="StarfishProjectSelector",h.displayName="ProjectOptionLabel"},"./app/views/starfish/components/tableCells/renderHeadCell.tsx":(e,t,s)=>{s.d(t,{W:()=>u,q:()=>l});var a=s("./app/components/gridEditable/sortLink.tsx"),r=s("./app/utils/discover/fields.tsx"),n=s("./app/views/starfish/types.tsx"),i=s("./app/views/starfish/views/queryParameters.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_SELF_TIME:p}=n.SpanMetricsFields,l=new Set([`p95(${p})`,`percentile_percent_change(${p}, 0.95)`,"sps()","sps_percent_change()","time_spent_percentage()","time_spent_percentage(local)","http_error_count()","http_error_count_percent_change()"]),u=e=>{let{column:t,location:s,sort:r}=e;const{key:n,name:p}=t,u=d(n);let c="desc";r?.field===t.key&&"desc"===r.kind&&(c="asc");const m=`${"desc"===c?"-":""}${n}`;return(0,o.tZ)(a.Z,{align:u,canSort:Boolean(s&&r&&l.has(n)),direction:r?.field===t.key?r.kind:void 0,title:p,generateSortLink:()=>({...s,query:{...s?.query,[i.o.SORT]:m}})})};u.displayName="renderHeadCell";const d=e=>{const t=(0,r.dL)(e);if(t){const s=(0,r._4)(t.name,t.arguments[0]);if(s)return(0,r.qG)(e,s)}return"left"}},"./app/views/starfish/utils/buildEventViewQuery.tsx":(e,t,s)=>{s.d(t,{$:()=>c}),s("../node_modules/core-js/modules/es.array.push.js");var a=s("./app/utils.tsx"),r=s("./app/views/starfish/types.tsx"),n=s("./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx");const{SPAN_DESCRIPTION:i,SPAN_OP:o,SPAN_DOMAIN:p,SPAN_ACTION:l,SPAN_MODULE:u}=r.SpanMetricsFields,d=[o,p,l,`!${u}`,"!span.category"];function c(e){let{moduleName:t,location:s,transaction:p,method:l,spanCategory:c}=e;const{query:m}=s,h=Object.keys(m).filter((e=>d.includes(e))).filter((e=>Boolean(m[e]))).map((e=>{const t=m[e],s=Array.isArray(t);if("!span.category"===e&&s&&t.includes("db")){const e=t.filter((e=>"db"!==e));return`(!span.category:db OR ${o}:db.redis) !span.category:[${e.join(",")}]`}return`${e}:${s?`[${t}]`:t}`}));return h.push(`has:${i}`),t!==r.rA.ALL&&h.push(`${u}:${t}`),t===r.rA.DB&&h.push(`!${o}:db.redis`),(0,a.ri)(c)&&(c===n.sZ?h.push("!has:span.category"):"Other"!==c&&h.push(`span.category:${c}`)),p&&h.push(`transaction:${p}`),l&&h.push(`transaction.method:${l}`),h}},"./app/views/starfish/utils/extractRoute.tsx":(e,t,s)=>{function a(e){return e.pathname.match(/^\/starfish\/api\//)?"api":e.pathname.match(/^\/starfish\/database\//)?"database":e.pathname.match(/^\/starfish\/endpoint-overview\//)?"endpoint-overview":null}s.d(t,{G:()=>a})},"./app/views/starfish/utils/useSpansQuery.tsx":(e,t,s)=>{s.d(t,{zT:()=>h,bB:()=>f,RX:()=>y}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/es.array.push.js");var a=s("../node_modules/moment/moment.js"),r=s.n(a),n=s("./app/utils/discover/discoverQuery.tsx"),i=s("./app/utils/discover/eventView.tsx"),o=s("./app/utils/discover/genericDiscoverQuery.tsx"),p=s("./app/utils/useLocation.tsx"),l=s("./app/utils/useOrganization.tsx"),u=s("./app/utils/usePageFilters.tsx"),d=s("./app/views/starfish/utils/retryHandlers.tsx"),c=s("../node_modules/react/index.js"),m=s("./app/utils/analytics.tsx");const h="YYYY-MM-DDTHH:mm:ssZ";function f(e){let{eventView:t,initialData:s,limit:a,enabled:r,referrer:n="use-spans-query",cursor:i}=e;const o=(t?.yAxis?.length??0)>0?g:y,{isReady:p}=(0,u.Z)();if(t){const e=o({eventView:t,initialData:s,limit:a,enabled:(r||void 0===r)&&p,referrer:n,cursor:i});return function(e,t){let{isLoading:s,statusCode:a}=t;const[r,n]=(0,c.useState)(null),[i,o]=(0,c.useState)(!1),p=(0,l.Z)();(0,c.useEffect)((()=>{if(s)null===r&&(n(Date.now()),o(!1));else if(!i&&(o(!0),r)){const e=Date.now();(0,m.Gi)("starfish.request",{organization:p,duration:e-r,statusCode:a}),n(null)}}),[i,e,r,p,s,a])}(t,e),e}throw new Error("eventView argument must be defined when Starfish useDiscover is true")}function g(e){let{eventView:t,enabled:s,initialData:a,referrer:n,cursor:c}=e;const m=(0,p.T)(),f=(0,l.Z)(),{isReady:g}=(0,u.Z)(),y=(0,o.JC)({route:"events-stats",eventView:t,location:m,orgSlug:f.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(m),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:0,partial:1,orderby:t.sorts?.[0]?(0,i.uZ)(t.sorts?.[0]):void 0,interval:t.interval,cursor:c}),options:{enabled:s&&g,refetchOnWindowFocus:!1,retry:d.V,retryDelay:d.P,staleTime:1/0},referrer:n}),x=y.isLoading&&a?a:function(e,t){if(!t.yAxis)return[];let s=[];const a=t.yAxis&&("string"==typeof t.yAxis||1===t.yAxis.length),n="string"==typeof t.yAxis?t.yAxis:t.yAxis[0];if(e.data){const t=v(e,a?n:"count").map((e=>({interval:r()(1e3*parseInt(e.interval,10)).format(h),[n]:e[n],group:e.group})));return t}return Object.keys(e).forEach((t=>{e[t].data?s=_(s,v(e[t],a?n:t)):Object.keys(e[t]).forEach((a=>{"order"!==a&&(s=_(s,v(e[t][a],a,t)))}))})),s.map((e=>({...e,interval:r()(1e3*parseInt(e.interval,10)).format(h)})))}(y.data,t);return{...y,data:x,meta:y.data?.meta}}function y(e){let{eventView:t,initialData:s,enabled:a,referrer:r,limit:i,cursor:o}=e;const c=(0,p.T)(),m=(0,l.Z)(),{isReady:h}=(0,u.Z)(),f=(0,n._)({eventView:t,orgSlug:m.slug,location:c,referrer:r,cursor:o,limit:i,options:{enabled:a&&h,refetchOnWindowFocus:!1,retry:d.V,retryDelay:d.P,staleTime:1/0}}),g=f.data?.meta;g&&(g.fields["sps()"]="rate",g.units["sps()"]="1/second");const y=f.isLoading&&s?s:f.data?.data;return{...f,data:y,meta:g}}function v(e,t,s){const a=[];return e.data.forEach((e=>{let[r,[{count:n}]]=e;const i=a.find((e=>e.interval===r&&(!s||e.group===s)));i?i[t]=n:a.push({interval:r,[t]:n,group:s})})),a}function _(e,t){const s=JSON.parse(JSON.stringify(e));return t.forEach((e=>{let{interval:t,group:a,...r}=e;const n=s.find((e=>e.interval===t&&(!a||e.group===a)));n?Object.keys(r).forEach((e=>{n[e]=r[e]})):s.push({interval:t,group:a,...r})})),s}},"./app/views/starfish/views/queryParameters.tsx":(e,t,s)=>{let a;s.d(t,{o:()=>a}),function(e){e.CURSOR="spansCursor",e.SORT="spansSort"}(a||(a={}))},"./app/views/starfish/views/spans/spansTable.tsx":(e,t,s)=>{s.d(t,{Z:()=>B,k:()=>I}),s("../node_modules/core-js/modules/es.array.push.js");var a=s("../node_modules/react/index.js"),r=s("../node_modules/react-router/es/index.js"),n=s("../node_modules/query-string/index.js"),i=s("./app/components/gridEditable/index.tsx"),o=s("./app/components/links/link.tsx"),p=s("./app/components/pagination.tsx"),l=s("./app/utils.tsx"),u=s("./app/utils/discover/fieldRenderers.tsx"),d=s("./app/utils/performanceForSentry/index.tsx"),c=s("./app/utils/queryString.tsx"),m=s("./app/utils/useLocation.tsx"),h=s("./app/utils/useOrganization.tsx"),f=s("./app/views/starfish/components/tableCells/renderHeadCell.tsx"),g=s("./app/views/starfish/components/textAlign.tsx"),y=s("../node_modules/lodash/omit.js"),v=s.n(y),_=s("./app/utils/discover/eventView.tsx"),x=s("./app/utils/discover/types.tsx"),w=s("./app/views/starfish/types.tsx"),S=s("./app/views/starfish/utils/buildEventViewQuery.tsx"),A=s("./app/views/starfish/utils/useSpansQuery.tsx");const{SPAN_SELF_TIME:P,SPAN_DESCRIPTION:N,SPAN_GROUP:b,SPAN_OP:Z,SPAN_DOMAIN:C}=w.SpanMetricsFields,j=function(e,t,s,a,r,n){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"api.starfish.use-span-list",o=arguments.length>7?arguments[7]:void 0;const p=function(e,t,s,a,r,n){const i=(0,S.$)({moduleName:e,location:t,transaction:s,method:a,spanCategory:r}).filter(Boolean).join(" "),o=[Z,b,N,C,"sps()","sps_percent_change()",`sum(${P})`,`p95(${P})`,`percentile_percent_change(${P}, 0.95)`,"http_error_count()","http_error_count_percent_change()"];(0,l.ri)(s)?o.push("time_spent_percentage(local)"):o.push("time_spent_percentage()");const p=_.ZP.fromNewQueryWithLocation({name:"",query:i,fields:o,dataset:x.as.SPANS_METRICS,version:2},v()(t,"span.category","http.method"));return n&&(p.sorts=n),p}(e,(0,m.T)(),t,s,a,r),{isLoading:u,data:d,meta:c,pageLinks:h}=(0,A.RX)({eventView:p,initialData:[],limit:n,referrer:i,cursor:o});return{isLoading:u,data:d,meta:c,pageLinks:h}};var T=s("./app/views/starfish/utils/extractRoute.tsx"),L=s("./app/views/starfish/views/queryParameters.tsx"),O=s("./app/views/starfish/views/spans/types.tsx"),k=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_SELF_TIME:D,SPAN_DESCRIPTION:E,SPAN_DOMAIN:q,SPAN_GROUP:F,SPAN_OP:$}=w.SpanMetricsFields,R=new Set([`p95(${D})`,`percentile_percent_change(${D}, 0.95)`,"sps()","sps_percent_change()","time_spent_percentage()","time_spent_percentage(local)","http_error_count()","http_error_count_percent_change()"]);function B(e){let{moduleName:t,sort:s,columnOrder:l,spanCategory:y,endpoint:v,method:_,limit:x=25}=e;const S=(0,m.T)(),A=(0,h.Z)(),P=(0,c.ro)(S.query?.[L.o.CURSOR]),{isLoading:N,data:b,meta:Z,pageLinks:C}=j(t??w.rA.ALL,v,_,y,[s],x,"api.starfish.use-span-list",P),O=Boolean(v);return(0,k.tZ)(a.Fragment,{children:(0,k.BX)(d.oF,{id:"SpansTable",hasData:(b?.length??0)>0,isLoading:N,disabled:O,children:[(0,k.tZ)(i.ZP,{isLoading:N,data:b,columnOrder:l??M(t,v),columnSortBy:[{key:s.field,order:s.kind}],grid:{renderHeadCell:e=>(0,f.W)({column:e,sort:s,location:S}),renderBodyCell:(e,t)=>function(e,t,s,a,r,i,p){if(e.key===E){const e={...a.query,endpoint:i,endpointMethod:p};return(0,k.tZ)(g._F,{children:t[F]?(0,k.tZ)(o.Z,{to:`/starfish/${(0,T.G)(a)??"spans"}/span/${t[F]}${e?`?${n.stringify(e)}`:""}`,children:t[E]||"<null>"}):t[E]||"<null>"})}if(!s||!s?.fields)return t[e.key];return(0,u.Js)(e.key,s.fields,!1)(t,{location:a,organization:r,unit:s.units?.[e.key]})}(e,t,Z,S,A,v,_)},location:S}),(0,k.tZ)(p.Z,{pageLinks:C,onCursor:(e,t,s)=>{r.browserHistory.push({pathname:t,query:{...s,[L.o.CURSOR]:e}})}})]})})}function M(e,t){const s=function(e){return e===w.rA.HTTP?"URL":e===w.rA.DB?"Query":"Description"}(e),a=function(e){return e===w.rA.HTTP?"Host":e===w.rA.DB?"Table":"Domain"}(e),r=[{key:$,name:"Operation",width:120},{key:E,name:s,width:i.z7},...e!==w.rA.ALL?[{key:q,name:a,width:i.z7}]:[],{key:"sps()",name:"Throughput",width:i.z7},{key:"sps_percent_change()",name:O.F.change,width:i.z7},{key:`p95(${D})`,name:O.F.p95,width:i.z7},{key:`percentile_percent_change(${D}, 0.95)`,name:O.F.change,width:i.z7},...e===w.rA.HTTP?[{key:"http_error_count()",name:O.F.errorCount,width:i.z7},{key:"http_error_count_percent_change()",name:O.F.change,width:i.z7}]:[]];return(0,l.ri)(t)?r.push({key:"time_spent_percentage(local)",name:O.F.timeSpent,width:i.z7}):r.push({key:"time_spent_percentage()",name:O.F.timeSpent,width:i.z7}),r}function I(e){return R.has(e.field)}B.displayName="SpansTable"},"./app/views/starfish/views/spans/spansView.tsx":(e,t,s)=>{s.d(t,{Z:()=>ue});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),n=s("../node_modules/lodash/pick.js"),i=s.n(n),o=s("./app/components/organizations/pageFilterBar.tsx"),p=s("./app/styles/space.tsx"),l=s("./app/utils/discover/eventView.tsx"),u=s("./app/utils/useLocation.tsx"),d=s("./app/views/starfish/components/datePicker.tsx"),c=s("./app/views/starfish/components/starfishProjectSelector.tsx"),m=s("./app/views/starfish/types.tsx"),h=s("./app/views/starfish/views/queryParameters.tsx"),f=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react-router/es/index.js")),g=s("../node_modules/lodash/omit.js"),y=s.n(g),v=s("./app/components/compactSelect/index.tsx"),_=s("./app/locale.tsx"),x=s("./app/utils/discover/types.tsx"),w=s("./app/views/starfish/utils/buildEventViewQuery.tsx"),S=s("./app/views/starfish/utils/useSpansQuery.tsx"),A=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_ACTION:P}=m.SpanMetricsFields;function N(e){let{value:t="",moduleName:s=m.rA.ALL,spanCategory:a}=e;const r=(0,u.T)(),n=function(e,t,s){const a=(0,w.$)({moduleName:t,location:{...e,query:y()(e.query,P)},spanCategory:s}).join(" ");return l.ZP.fromNewQueryWithLocation({name:"",fields:[P,"count()"],orderby:"-count",query:a,dataset:x.as.SPANS_METRICS,version:2},e)}(r,s,a),i=s===m.rA.HTTP,{data:o}=(0,S.bB)({eventView:n,initialData:[],enabled:!i,referrer:"api.starfish.get-span-actions"}),p=i?b:[{value:"",label:"All"},...(o??[]).filter((e=>e[P])).map((e=>({value:e[P],label:e[P]})))];return(0,A.tZ)(v.Z,{triggerProps:{prefix:Z[s]},value:t,options:p??[],onChange:e=>{f.browserHistory.push({...r,query:{...r.query,[P]:e.value}})}})}N.displayName="ActionSelector";const b=[{value:"",label:"All"},...["GET","POST","PUT","DELETE"].map((e=>({value:e,label:e})))],Z={http:(0,_.t)("HTTP Method"),db:(0,_.t)("SQL Command"),none:(0,_.t)("Action"),"":(0,_.t)("Action")},{SPAN_DOMAIN:C}=m.SpanMetricsFields;function j(e){let{value:t="",moduleName:s=m.rA.ALL,spanCategory:a}=e;const r=(0,u.T)(),n=function(e,t,s){const a=(0,w.$)({moduleName:t,location:{...e,query:y()(e.query,C)},spanCategory:s}).join(" ");return l.ZP.fromNewQueryWithLocation({name:"",fields:["span.domain","count()"],orderby:"-count",query:a,dataset:x.as.SPANS_METRICS,version:2},e)}(r,s,a),{data:i}=(0,S.bB)({eventView:n,initialData:[],referrer:"api.starfish.get-span-domains"}),o=[{value:"",label:"All"},...(i??[]).map((e=>({value:e["span.domain"],label:e["span.domain"]})))];return(0,A.tZ)(v.Z,{triggerProps:{prefix:T[s]},value:t,options:o??[],onChange:e=>{f.browserHistory.push({...r,query:{...r.query,"span.domain":e.value}})}})}j.displayName="DomainSelector";const T={http:(0,_.t)("Host"),db:(0,_.t)("Table"),none:(0,_.t)("Domain"),"":(0,_.t)("Domain")},{SPAN_OP:L}=m.SpanMetricsFields;function O(e){let{value:t="",moduleName:s=m.rA.ALL,spanCategory:a}=e;const r=(0,u.T)(),n=function(e,t,s){const a=(0,w.$)({moduleName:t,location:{...e,query:y()(e.query,L)},spanCategory:s}).join(" ");return l.ZP.fromNewQueryWithLocation({name:"",fields:[L,"count()"],orderby:"-count",query:a,dataset:x.as.SPANS_METRICS,version:2},e)}(r,s,a),{data:i}=(0,S.bB)({eventView:n,initialData:[],referrer:"api.starfish.get-span-operations"}),o=[{value:"",label:"All"},...(i??[]).map((e=>({value:e[L],label:e[L]})))];return(0,A.tZ)(v.Z,{triggerProps:{prefix:(0,_.t)("Operation")},value:t,options:o??[],onChange:e=>{f.browserHistory.push({...r,query:{...r.query,[L]:e.value}})}})}O.displayName="SpanOperationSelector";var k=s("./app/components/charts/utils.tsx"),D=s("./app/utils/usePageFilters.tsx"),E=s("./app/views/starfish/colours.tsx"),q=s("./app/views/starfish/components/chart.tsx"),F=s("./app/views/starfish/components/chartPanel.tsx"),$=s("./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts"),R=s("./app/views/starfish/utils/constants.tsx"),B=s("../node_modules/moment/moment.js");const M=e=>{const t=(0,D.Z)(),s={id:void 0,name:"HTTP Module - HTTP error rate",fields:["http_error_count()"],query:e,version:1,topEvents:"5",dataset:x.as.SPANS_METRICS,interval:(0,k.ZS)(t.selection.datetime,R.R),yAxis:["http_error_count()"]},a=l.ZP.fromNewQueryWithPageFilters(s,t.selection),r=(0,S.bB)({eventView:a,initialData:[],referrer:"api.starfish.get-http-error-count"}),n=r?.data?.map((e=>({interval:(0,B.unix)(e.interval).format("YYYY-MM-DDTHH:mm:ss"),"http_error_count()":e["http_error_count()"]})));return{...r,formattedData:n}};var I=s("./app/views/starfish/views/spans/types.tsx"),V=s("./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx");const{SPAN_SELF_TIME:H,SPAN_OP:z,SPAN_MODULE:Q,SPAN_DESCRIPTION:W}=m.SpanMetricsFields;function G(e){let{moduleName:t,appliedFilters:s,spanCategory:a}=e;const{selection:r}=(0,D.Z)(),n=K(t,r,s,a),{isLoading:i}=(0,S.bB)({eventView:n,initialData:[],referrer:"api.starfish.span-time-charts"});(0,q.K4)([!i]);const o={[m.rA.ALL]:[{title:I.F.throughput,Comp:U},{title:I.F.p95,Comp:Y}],[m.rA.DB]:[],[m.rA.HTTP]:[{title:I.F.errorCount,Comp:X}],[m.rA.NONE]:[]},p=[...o[m.rA.ALL]];return t!==m.rA.ALL&&p.push(...o[t]),(0,A.tZ)(te,{children:p.map((e=>{let{title:a,Comp:r}=e;return(0,A.tZ)(se,{children:(0,A.tZ)(F.Z,{title:a,children:(0,A.tZ)(r,{moduleName:t,filters:s})})},a)}))})}function U(e){let{moduleName:t,filters:s}=e;const a=(0,D.Z)(),r=K(t,a.selection,s),n=function(e){return e===m.rA.DB?"Queries":"Requests"}(t),{isLoading:i,data:o}=(0,S.bB)({eventView:r,initialData:[],referrer:"api.starfish.span-time-charts"}),p={[n]:o},l=Object.keys(p).map((e=>({seriesName:n??"Throughput",data:(p[e]??[]).map((e=>({value:e["sps()"],name:e.interval})))})));return(0,A.tZ)(q.ZP,{statsPeriod:"24h",height:100,data:l,start:"",end:"",loading:i,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,aggregateOutputFormat:"rate",stacked:!0,isLineChart:!0,chartColors:[E.SQ],tooltipFormatterOptions:{valueFormatter:e=>(0,$.Z)(e)}})}function Y(e){let{moduleName:t,filters:s}=e;const a=(0,D.Z)(),r=K(t,a.selection,s),n=`p95(${H})`,{isLoading:i,data:o}=(0,S.bB)({eventView:r,initialData:[],referrer:"api.starfish.span-time-charts"}),p={[n]:o},l=Object.keys(p).map((e=>({seriesName:n,data:(p[e]??[]).map((e=>({value:e[`p95(${H})`],name:e.interval})))})));return(0,A.tZ)(q.ZP,{statsPeriod:"24h",height:100,data:[...l],start:"",end:"",loading:i,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[E.Tn]})}function X(e){let{moduleName:t,filters:s}=e;const a=ee(t,s),{isLoading:r,data:n}=M(a),i={seriesName:I.F.errorCount,data:n?.length?n?.map((e=>({name:e.interval,value:e["http_error_count()"]}))):[]};return(0,A.tZ)(q.ZP,{statsPeriod:"24h",height:100,data:[i],start:"",end:"",loading:r,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[E.eO]})}G.displayName="SpanTimeCharts",U.displayName="ThroughputChart",Y.displayName="DurationChart",X.displayName="ErrorChart";const J=["span_operation","domain","action"],K=(e,t,s,a)=>{const r=ee(e,s,a);return l.ZP.fromNewQueryWithPageFilters({name:"",fields:[""],yAxis:["sps()",`p50(${H})`,`p95(${H})`],query:r,dataset:x.as.SPANS_METRICS,interval:(0,k.ZS)(t.datetime,R.R),version:2},t)},ee=(e,t,s)=>{const a=Object.keys(t).filter((e=>J.includes(e))).filter((e=>Boolean(t[e]))).map((e=>`${e}:${t[e]}`));return a.push(`has:${W}`),e!==m.rA.ALL&&a.push(`${Q}:${e}`),e===m.rA.DB&&a.push(`!${z}:db.redis`),s&&(s===V.sZ?a.push("!has:span.category"):"Other"!==s&&a.push(`span.category:${s}`)),a.join(" ")},te=(0,a.Z)("div",{target:"e1evs38o1"})("display:flex;flex-direction:row;flex-wrap:wrap;gap:",(0,p.D)(2),";"),se=(0,a.Z)("div",{target:"e1evs38o0"})({name:"82a6rk",styles:"flex:1"});var ae=s("./app/views/starfish/views/spans/spansTable.tsx");const{SPAN_ACTION:re,SPAN_DOMAIN:ne,SPAN_OP:ie,SPAN_GROUP:oe}=m.SpanMetricsFields,pe={kind:"desc",field:"time_spent_percentage()"},le=25;function ue(e){const t=(0,u.T)(),s=i()(t.query,[re,ne,ie,oe]),a=(0,l.vp)(t.query[h.o.SORT]).filter(ae.k)[0]??pe;return(0,A.BX)(r.Fragment,{children:[(0,A.BX)(me,{condensed:!0,children:[(0,A.tZ)(c.Z,{}),(0,A.tZ)(d.Z,{})]}),(0,A.tZ)(de,{children:(0,A.tZ)(G,{moduleName:e.moduleName||m.rA.ALL,appliedFilters:s,spanCategory:e.spanCategory})}),(0,A.BX)(ce,{children:[(0,A.tZ)(O,{moduleName:e.moduleName,value:s[ie]||"",spanCategory:e.spanCategory}),(0,A.tZ)(N,{moduleName:e.moduleName,value:s[re]||"",spanCategory:e.spanCategory}),(0,A.tZ)(j,{moduleName:e.moduleName,value:s[ne]||"",spanCategory:e.spanCategory})]}),(0,A.tZ)(de,{children:(0,A.tZ)(ae.Z,{moduleName:e.moduleName||m.rA.ALL,spanCategory:e.spanCategory,sort:a,limit:le})})]})}ue.displayName="SpansView";const de=(0,a.Z)("div",{target:"e1ojq8vq2"})("margin:0 ",(0,p.D)(2),";"),ce=(0,a.Z)(de,{target:"e1ojq8vq1"})("display:flex;flex-direction:row;gap:",(0,p.D)(1),";margin-bottom:",(0,p.D)(2),";"),me=(0,a.Z)(o.Z,{target:"e1ojq8vq0"})("margin:0 ",(0,p.D)(2),";margin-bottom:",(0,p.D)(2),";")}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_contexts_pageError_tsx-app_views_starfish_views_spans_spansView_tsx.18ef27f59b350340420e19140694d954.js.map