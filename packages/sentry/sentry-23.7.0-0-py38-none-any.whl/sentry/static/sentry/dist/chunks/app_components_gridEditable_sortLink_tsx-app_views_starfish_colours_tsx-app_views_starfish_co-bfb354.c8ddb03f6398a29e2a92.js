"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_gridEditable_sortLink_tsx-app_views_starfish_colours_tsx-app_views_starfish_co-bfb354"],{"./app/components/gridEditable/sortLink.tsx":(e,t,s)=>{s.d(t,{Z:()=>u});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react-router/es/index.js"),i=s("./app/components/links/link.tsx"),n=s("./app/icons/index.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{align:t,title:s,canSort:a,generateSortLink:i,onClick:n,direction:l,replace:u}=e;const m=i();if(!m||!a)return(0,o.tZ)(c,{align:t,children:s});const h=l?(0,o.tZ)(p,{size:"xs",direction:"desc"===l?"down":"up"}):null;return(0,o.BX)(d,{align:t,to:m,onClick:e=>{u&&(e.preventDefault(),r.browserHistory.replace(m)),n?.(e)},children:[s," ",h]})}l.displayName="SortLink";const d=(0,a.Z)((e=>{const{align:t,css:s,...a}=e;return(0,o.tZ)(i.Z,{...a})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),c=(0,a.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),p=(0,a.Z)(n.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),u=l},"./app/utils/discover/discoverQuery.tsx":(e,t,s)=>{s.d(t,{Z:()=>l,_:()=>o});var a=s("./app/utils/discover/genericDiscoverQuery.tsx"),r=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function n(e){return(0,r.tZ)(a.ZP,{route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:s,...a}=e.meta??{};return{...e,meta:{...s,...a}}},...e})}function o(e){const t=(0,a.JC)({route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:s,...a}=e.meta??{};return{...e,meta:{...s,...a}}},...e}),s=t.response?.getResponseHeader("Link")??void 0;return{...t,pageLinks:s}}n.displayName="DiscoverQuery";const l=n},"./app/views/starfish/colours.tsx":(e,t,s)=>{s.d(t,{SQ:()=>r,Tn:()=>i,eO:()=>n});var a=s("./app/constants/chartPalette.tsx");const r=a.$[3][3],i=(a.$[3][1],a.$[0][0]),n=a.$[5][3]},"./app/views/starfish/components/datePicker.tsx":(e,t,s)=>{s.d(t,{Z:()=>l});var a=s("./app/components/datePageFilter.tsx"),r=s("./app/utils/analytics.tsx"),i=s("./app/utils/useOrganization.tsx"),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(){const e=(0,i.Z)();return(0,n.tZ)(a.Z,{defaultPeriod:"24h",alignDropdown:"left",onChange:t=>{let{start:s,end:a,relative:i}=t;(0,r.Gi)("starfish.page_filter.data_change",{organization:e,start:s,end:a,relative:i})}})}o.displayName="StarfishDatePicker";const l=o},"./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts":(e,t,s)=>{s.d(t,{Z:()=>r});var a=s("./app/locale.tsx");const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return`${-1===e?"--":e.toFixed(2)} / ${(0,a.t)("s")}`}},"./app/views/starfish/utils/constants.tsx":(e,t,s)=>{s.d(t,{R:()=>a});const a="metrics"},"./app/views/starfish/utils/retryHandlers.tsx":(e,t,s)=>{function a(e,t){return e<3&&t.message.includes("429")}function r(e){return 1e3*Math.pow(3,e)}s.d(t,{P:()=>r,V:()=>a})},"./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx":(e,t,s)=>{s.d(t,{Jg:()=>I,sZ:()=>G,_2:()=>M});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),i=s("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),n=s("./app/components/charts/utils.tsx"),o=s("./app/components/panels/panel.tsx"),l=s("./app/locale.tsx"),d=s("./app/styles/space.tsx"),c=s("./app/utils.tsx"),p=s("./app/utils/discover/discoverQuery.tsx"),u=s("./app/utils/discover/eventView.tsx"),m=s("./app/utils/discover/types.tsx"),h=s("./app/utils/useLocation.tsx"),g=s("./app/utils/useOrganization.tsx"),v=s("./app/utils/usePageFilters.tsx"),f=s("./app/views/starfish/types.tsx"),x=s("./app/views/starfish/utils/constants.tsx"),y=s("./app/utils/discover/genericDiscoverQuery.tsx"),w=s("./app/views/starfish/utils/retryHandlers.tsx"),b=s("../node_modules/react-router/es/index.js"),_=s("../node_modules/lodash/cloneDeep.js"),E=s.n(_),T=s("../node_modules/query-string/index.js"),Z=s("./app/components/compactSelect/index.tsx"),P=s("./app/utils/analytics.tsx"),D=s("./app/utils/discover/charts.tsx"),k=s("./app/utils/performanceForSentry/index.tsx"),S=s("./app/views/starfish/components/chart.tsx"),N=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_MODULE:$}=f.SpanMetricsFields;function C(e){let{topSeriesData:t,transaction:s,isTimeseriesLoading:a,errored:r,options:i,dataDisplayType:n,setDataDisplayType:o}=e;const d=(0,g.Z)(),c=d.features.includes("starfish-wsv-chart-dropdown"),p=[];for(let e=0;e<t.length;e++){const s=t[e];s.emphasis={disabled:!1,focus:"series"},s.blur={areaStyle:{opacity:.3}},s.triggerLineEvent=!0,p.push(s)}const u=E()(p),m=t[0]?.data?.length??0;for(let e=0;e<m;e++){const s=t.reduce(((t,s)=>t+s.data[e].value),0);u.forEach((t=>{const a={...t.data[e]};a.value=0===s?0:a.value/s,t.data[e]=a}))}const h=Boolean(s);return(0,N.tZ)(R,{children:(0,N.BX)(j,{children:[(0,N.BX)(L,{children:[(0,N.tZ)(A,{children:h?(0,l.t)("Endpoint Breakdown"):(0,l.t)("Service Breakdown")}),c&&(0,N.tZ)(Z.Z,{options:i,value:n,onChange:e=>{o(e.value),(0,P.Gi)("starfish.web_service_view.breakdown.display_change",{organization:d,display:e.value})}})]}),(0,N.tZ)(k.oF,{id:"WSV.SpanGroupBreakdown",hasData:t.length>0,children:(0,N.tZ)(S.ZP,{statsPeriod:"24h",height:340,showLegend:!0,data:n===I.PERCENTAGE?u:t,dataMax:n===I.PERCENTAGE?1:void 0,durationUnit:n===I.PERCENTAGE?.25:void 0,start:"",end:"",errored:r,loading:a,utc:!1,onClick:e=>{let s;const a={};"db"===e.seriesName?s="/starfish/database/":"http"===e.seriesName?s="/starfish/api/":"Other"===e.seriesName?a["!span.category"]=t.map((e=>e.seriesName)):(a[$]="Other",a["span.category"]=e.seriesName),s||(s=`/starfish/spans/?${T.stringify(a)}`),b.browserHistory.push(s)},grid:{left:"0",right:"0",top:"20px",bottom:"0"},definedAxisTicks:6,stacked:!0,aggregateOutputFormat:n===I.PERCENTAGE?"percentage":"duration",tooltipFormatterOptions:{valueFormatter:e=>n===I.PERCENTAGE?(0,D.Ew)(e,"percentage"):(0,D.Ew)(e,"duration")},onLegendSelectChanged:e=>{(0,P.Gi)("starfish.web_service_view.breakdown.legend_change",{organization:d,selected:Object.keys(e.selected).filter((t=>e.selected[t])),toggled:e.name})}})})]})})}C.displayName="SpanGroupBreakdown";const j=(0,a.Z)("div",{target:"e1sx7q3i3"})("padding:0 ",(0,d.D)(2),";flex:2;"),A=(0,a.Z)("p",{target:"e1sx7q3i2"})((e=>e.theme.text.cardTitle),";"),L=(0,a.Z)("div",{target:"e1sx7q3i1"})("padding:0 ",(0,d.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,d.D)(1),";"),R=(0,a.Z)("div",{target:"e1sx7q3i0"})("display:flex;min-height:200px;padding-bottom:",(0,d.D)(2),";"),{SPAN_SELF_TIME:O}=f.SpanMetricsFields,F="Other",G=(0,l.t)("custom");let I;function M(e){let{transaction:t,transactionMethod:s}=e;const a=(0,v.Z)(),n=(0,g.Z)(),o=(0,h.T)(),{selection:l}=a,d=(0,i.u)(),m=[{label:"Percentages",value:I.PERCENTAGE},{label:"Duration (p95)",value:I.DURATION_P95},{label:"Total Duration",value:I.CUMULATIVE_DURATION}],[f,x]=(0,r.useState)(I.PERCENTAGE),{data:b,isLoading:_}=(0,p._)({eventView:B(l,`transaction.op:http.server ${t?`transaction:${t}`:""} ${s?`http.method:${s}`:""}`,["span.category"]),orgSlug:n.slug,referrer:"api.starfish-web-service.span-category-breakdown",location:o,limit:4}),{data:E,isLoading:T}=(0,p._)({eventView:B(l,`transaction.op:http.server ${t?`transaction:${t}`:""} ${s?`http.method:${s}`:""}`,[]),orgSlug:n.slug,referrer:"api.starfish-web-service.total-time",location:o}),{isLoading:Z,data:P,isError:D}=function(e){let{eventView:t,enabled:s,initialData:a,referrer:r}=e;const i=(0,h.T)(),n=(0,g.Z)(),{isLoading:o,data:l,isError:d}=(0,y.JC)({route:"events-stats",eventView:t,location:i,orgSlug:n.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(i),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:0,partial:1,orderby:t.sorts?.[0]?(0,u.uZ)(t.sorts?.[0]):void 0,interval:t.interval}),options:{enabled:s,refetchOnWindowFocus:!1,retry:w.V,retryDelay:w.P,staleTime:1/0},referrer:r});return{isLoading:o,data:o&&a?a:l,isError:d}}({eventView:U(l,`transaction.op:http.server ${t?`transaction:${t}`:""} ${s?`http.method:${s}`:""}`,["span.category"],f,!0),enabled:!0,referrer:"api.starfish-web-service.span-category-breakdown-timeseries",initialData:[]}),k=E?.data[0]?.[`sum(${O})`]?parseInt(E?.data[0][`sum(${O})`],10):0,S=b?.data.reduce(((e,t)=>e+parseInt(t[`sum(${O})`],10)),0)??0,$=k?k-S:0,j=[];if((0,c.ri)(b)){for(let e=0;e<b.data.length;e++){const t=b.data[e],s=t["span.category"];j.push({cumulativeTime:parseInt(t[`sum(${O})`],10),group:{"span.category":""===s?G:s}})}$>0&&F in P&&j.push({cumulativeTime:$,group:{"span.category":F}})}const A={},L=d.charts.getColorPalette(j.length-2);(0,c.ri)(P)&&!Z&&j.length>0&&(j.forEach(((e,t)=>{const s=e.group["span.category"],a=""===s?G:s;A[a]={seriesName:a,data:[],color:L[t]}})),Object.keys(P).forEach((e=>{const t=P?.[e];A[""===e?G:e].data=t?.data.map((e=>({name:1e3*e[0],value:e[1][0].count})))??[]})));const R=Object.values(A);return(0,N.tZ)(V,{children:(0,N.tZ)(C,{tableData:j,totalCumulativeTime:k,isTableLoading:_,topSeriesData:R,colorPalette:L,isTimeseriesLoading:Z,isCumulativeTimeLoading:T,transaction:t,errored:D,options:m,dataDisplayType:f,setDataDisplayType:x})})}!function(e){e.DURATION_P95="duration_p95",e.CUMULATIVE_DURATION="cumulative_duration",e.PERCENTAGE="percentage"}(I||(I={})),M.displayName="SpanGroupBreakdownContainer";const V=(0,a.Z)(o.Z,{target:"eoo99dh0"})("padding-top:",(0,d.D)(2),";margin-bottom:0;"),U=(e,t,s,a,r)=>{const i=a===I.DURATION_P95?`p95(${O})`:`sum(${O})`;return u.ZP.fromNewQueryWithPageFilters({name:"",fields:[`sum(${O})`,`p95(${O})`,...s],yAxis:r?[i]:[],query:t,dataset:m.as.SPANS_METRICS,orderby:"-sum_span_self_time",version:2,topEvents:s.length>0?"4":void 0,interval:r?(0,n.ZS)(e.datetime,x.R):void 0},e)},B=(e,t,s)=>u.ZP.fromNewQueryWithPageFilters({name:"",fields:[`sum(${O})`,...s],query:t,dataset:m.as.SPANS_METRICS,orderby:"-sum_span_self_time",version:2,topEvents:s.length>0?"4":void 0},e)}}]);
//# sourceMappingURL=../sourcemaps/app_components_gridEditable_sortLink_tsx-app_views_starfish_colours_tsx-app_views_starfish_co-bfb354.1cff0e91b5ca4ba741d9cb1bbeb010ef.js.map