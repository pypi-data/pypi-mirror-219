"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spanSummaryPage_index_tsx"],{"./app/utils/discover/discoverQuery.tsx":(t,e,a)=>{a.d(e,{Z:()=>l,_:()=>o});var n=a("./app/utils/discover/genericDiscoverQuery.tsx"),s=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(t,e){return t.transactionName!==e.transactionName||t.transactionThreshold!==e.transactionThreshold||t.transactionThresholdMetric!==e.transactionThresholdMetric}function i(t){return(0,s.tZ)(n.ZP,{route:"events",shouldRefetchData:r,afterFetch:(t,e)=>{const{fields:a,...n}=t.meta??{};return{...t,meta:{...a,...n}}},...t})}function o(t){const e=(0,n.JC)({route:"events",shouldRefetchData:r,afterFetch:(t,e)=>{const{fields:a,...n}=t.meta??{};return{...t,meta:{...a,...n}}},...t}),a=e.response?.getResponseHeader("Link")??void 0;return{...e,pageLinks:a}}i.displayName="DiscoverQuery";const l=i},"./app/utils/performance/contexts/pageError.tsx":(t,e,a)=>{a.d(e,{De:()=>p,V_:()=>o,YY:()=>l});var n=a("../node_modules/react/index.js"),s=a("./app/components/alert.tsx"),r=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,n.createContext)({pageError:void 0,setPageError:t=>{}});function o(t){let{children:e}=t;const[a,s]=(0,n.useState)();return(0,r.tZ)(i.Provider,{value:{pageError:a,setPageError:s},children:e})}function l(){const{pageError:t}=(0,n.useContext)(i);return t?(0,r.tZ)(s.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:t}):null}o.displayName="PageErrorProvider",l.displayName="PageErrorAlert";const p=()=>(0,n.useContext)(i)},"./app/views/starfish/colours.tsx":(t,e,a)=>{a.d(e,{SQ:()=>s,Tn:()=>r,eO:()=>i});var n=a("./app/constants/chartPalette.tsx");const s=n.$[3][3],r=(n.$[3][1],n.$[0][0]),i=n.$[5][3]},"./app/views/starfish/components/chartPanel.tsx":(t,e,a)=>{a.d(e,{Z:()=>l});var n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(a("../node_modules/react/index.js"),a("./app/components/panels/panel.tsx")),r=a("./app/components/panels/panelBody.tsx"),i=a("./app/styles/space.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(t){let{title:e,children:a,button:n}=t;return(0,o.tZ)(s.Z,{children:(0,o.BX)(r.Z,{withPadding:!0,children:[e&&(0,o.BX)(c,{children:[e&&(0,o.tZ)(p,{children:e}),n]}),a]})})}l.displayName="ChartPanel";const p=(0,n.Z)("p",{target:"e1tvnfsq1"})((t=>t.theme.text.cardTitle),";"),c=(0,n.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,i.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/components/datePicker.tsx":(t,e,a)=>{a.d(e,{Z:()=>l});var n=a("./app/components/datePageFilter.tsx"),s=a("./app/utils/analytics.tsx"),r=a("./app/utils/useOrganization.tsx"),i=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(){const t=(0,r.Z)();return(0,i.tZ)(n.Z,{defaultPeriod:"24h",alignDropdown:"left",onChange:e=>{let{start:a,end:n,relative:r}=e;(0,s.Gi)("starfish.page_filter.data_change",{organization:t,start:a,end:n,relative:r})}})}o.displayName="StarfishDatePicker";const l=o},"./app/views/starfish/components/samplesTable/common.tsx":(t,e,a)=>{a.d(e,{f:()=>l,k:()=>p});var n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=a("./app/locale.tsx"),r=a("./app/utils/formatters.tsx"),i=a("./app/views/starfish/components/textAlign.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(t){let{duration:e,p95:a,containerProps:n}=t;const l=e-a;if(p(e,a))return(0,o.tZ)(i.Dq,{...n,children:(0,s.t)("Near baseline")});const d=(0,r.g9)(l/1e3,2,!0,!0),u=l>0?`+${d} above`:`${d} below`;return(0,o.tZ)(c,{...n,value:l,children:u})}l.displayName="DurationComparisonCell";const p=(t,e)=>{const a=.03*e;return Math.abs(t-e)<a},c=(0,n.Z)("span",{target:"e1tr2orr0"})("color:",(t=>0===t.value?t.theme.subText:t.value<0?t.theme.green400:t.theme.red400),";text-align:right;")},"./app/views/starfish/components/tableCells/renderHeadCell.tsx":(t,e,a)=>{a.d(e,{W:()=>c,q:()=>p});var n=a("./app/components/gridEditable/sortLink.tsx"),s=a("./app/utils/discover/fields.tsx"),r=a("./app/views/starfish/types.tsx"),i=a("./app/views/starfish/views/queryParameters.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const{SPAN_SELF_TIME:l}=r.SpanMetricsFields,p=new Set([`p95(${l})`,`percentile_percent_change(${l}, 0.95)`,"sps()","sps_percent_change()","time_spent_percentage()","time_spent_percentage(local)","http_error_count()","http_error_count_percent_change()"]),c=t=>{let{column:e,location:a,sort:s}=t;const{key:r,name:l}=e,c=d(r);let u="desc";s?.field===e.key&&"desc"===s.kind&&(u="asc");const m=`${"desc"===u?"-":""}${r}`;return(0,o.tZ)(n.Z,{align:c,canSort:Boolean(a&&s&&p.has(r)),direction:s?.field===e.key?s.kind:void 0,title:l,generateSortLink:()=>({...a,query:{...a?.query,[i.o.SORT]:m}})})};c.displayName="renderHeadCell";const d=t=>{const e=(0,s.dL)(t);if(e){const a=(0,s._4)(e.name,e.arguments[0]);if(a)return(0,s.qG)(t,a)}return"left"}},"./app/views/starfish/components/tableCells/throughputCell.tsx":(t,e,a)=>{a.d(e,{Z:()=>o});var n=a("./app/locale.tsx"),s=a("./app/utils/discover/styles.tsx"),r=a("./app/utils/formatters.tsx"),i=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function o(t){let{throughputPerSecond:e,containerProps:a}=t;const o=e?(0,r.Du)(e):"--";return(0,i.BX)(s.Hw,{...a,children:[o,"/",(0,n.t)("s")]})}o.displayName="ThroughputCell"},"./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts":(t,e,a)=>{a.d(e,{Z:()=>s});var n=a("./app/locale.tsx");const s=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return`${-1===t?"--":t.toFixed(2)} / ${(0,n.t)("s")}`}},"./app/views/starfish/utils/constants.tsx":(t,e,a)=>{a.d(e,{R:()=>n});const n="metrics"},"./app/views/starfish/utils/extractRoute.tsx":(t,e,a)=>{function n(t){return t.pathname.match(/^\/starfish\/api\//)?"api":t.pathname.match(/^\/starfish\/database\//)?"database":t.pathname.match(/^\/starfish\/endpoint-overview\//)?"endpoint-overview":null}a.d(e,{G:()=>n})},"./app/views/starfish/utils/getDateConditions.tsx":(t,e,a)=>{a.d(e,{x:()=>r});var n=a("./app/components/organizations/pageFilters/parse.tsx"),s=a("./app/views/starfish/utils/getDateFilters.tsx");const r=t=>{const{startTime:e,endTime:a,statsPeriod:r}=(0,s.t)(t),{start:i,end:o}=(0,n.fK)({start:e.toDate(),end:a.toDate()});return r?{statsPeriod:r}:{start:i,end:o}}},"./app/views/starfish/utils/retryHandlers.tsx":(t,e,a)=>{function n(t,e){return t<3&&e.message.includes("429")}function s(t){return 1e3*Math.pow(3,t)}a.d(e,{P:()=>s,V:()=>n})},"./app/views/starfish/utils/useSpansQuery.tsx":(t,e,a)=>{a.d(e,{zT:()=>h,bB:()=>g,RX:()=>y}),a("../node_modules/core-js/modules/es.error.cause.js"),a("../node_modules/core-js/modules/es.array.push.js");var n=a("../node_modules/moment/moment.js"),s=a.n(n),r=a("./app/utils/discover/discoverQuery.tsx"),i=a("./app/utils/discover/eventView.tsx"),o=a("./app/utils/discover/genericDiscoverQuery.tsx"),l=a("./app/utils/useLocation.tsx"),p=a("./app/utils/useOrganization.tsx"),c=a("./app/utils/usePageFilters.tsx"),d=a("./app/views/starfish/utils/retryHandlers.tsx"),u=a("../node_modules/react/index.js"),m=a("./app/utils/analytics.tsx");const h="YYYY-MM-DDTHH:mm:ssZ";function g(t){let{eventView:e,initialData:a,limit:n,enabled:s,referrer:r="use-spans-query",cursor:i}=t;const o=(e?.yAxis?.length??0)>0?f:y,{isReady:l}=(0,c.Z)();if(e){const t=o({eventView:e,initialData:a,limit:n,enabled:(s||void 0===s)&&l,referrer:r,cursor:i});return function(t,e){let{isLoading:a,statusCode:n}=e;const[s,r]=(0,u.useState)(null),[i,o]=(0,u.useState)(!1),l=(0,p.Z)();(0,u.useEffect)((()=>{if(a)null===s&&(r(Date.now()),o(!1));else if(!i&&(o(!0),s)){const t=Date.now();(0,m.Gi)("starfish.request",{organization:l,duration:t-s,statusCode:n}),r(null)}}),[i,t,s,l,a,n])}(e,t),t}throw new Error("eventView argument must be defined when Starfish useDiscover is true")}function f(t){let{eventView:e,enabled:a,initialData:n,referrer:r,cursor:u}=t;const m=(0,l.T)(),g=(0,p.Z)(),{isReady:f}=(0,c.Z)(),y=(0,o.JC)({route:"events-stats",eventView:e,location:m,orgSlug:g.slug,getRequestPayload:()=>({...e.getEventsAPIPayload(m),yAxis:e.yAxis,topEvents:e.topEvents,excludeOther:0,partial:1,orderby:e.sorts?.[0]?(0,i.uZ)(e.sorts?.[0]):void 0,interval:e.interval,cursor:u}),options:{enabled:a&&f,refetchOnWindowFocus:!1,retry:d.V,retryDelay:d.P,staleTime:1/0},referrer:r}),S=y.isLoading&&n?n:function(t,e){if(!e.yAxis)return[];let a=[];const n=e.yAxis&&("string"==typeof e.yAxis||1===e.yAxis.length),r="string"==typeof e.yAxis?e.yAxis:e.yAxis[0];if(t.data){const e=v(t,n?r:"count").map((t=>({interval:s()(1e3*parseInt(t.interval,10)).format(h),[r]:t[r],group:t.group})));return e}return Object.keys(t).forEach((e=>{t[e].data?a=x(a,v(t[e],n?r:e)):Object.keys(t[e]).forEach((n=>{"order"!==n&&(a=x(a,v(t[e][n],n,e)))}))})),a.map((t=>({...t,interval:s()(1e3*parseInt(t.interval,10)).format(h)})))}(y.data,e);return{...y,data:S,meta:y.data?.meta}}function y(t){let{eventView:e,initialData:a,enabled:n,referrer:s,limit:i,cursor:o}=t;const u=(0,l.T)(),m=(0,p.Z)(),{isReady:h}=(0,c.Z)(),g=(0,r._)({eventView:e,orgSlug:m.slug,location:u,referrer:s,cursor:o,limit:i,options:{enabled:n&&h,refetchOnWindowFocus:!1,retry:d.V,retryDelay:d.P,staleTime:1/0}}),f=g.data?.meta;f&&(f.fields["sps()"]="rate",f.units["sps()"]="1/second");const y=g.isLoading&&a?a:g.data?.data;return{...g,data:y,meta:f}}function v(t,e,a){const n=[];return t.data.forEach((t=>{let[s,[{count:r}]]=t;const i=n.find((t=>t.interval===s&&(!a||t.group===a)));i?i[e]=r:n.push({interval:s,[e]:r,group:a})})),n}function x(t,e){const a=JSON.parse(JSON.stringify(t));return e.forEach((t=>{let{interval:e,group:n,...s}=t;const r=a.find((t=>t.interval===e&&(!n||t.group===n)));r?Object.keys(s).forEach((t=>{r[t]=s[t]})):a.push({interval:e,group:n,...s})})),a}},"./app/views/starfish/views/queryParameters.tsx":(t,e,a)=>{let n;a.d(e,{o:()=>n}),function(t){t.CURSOR="spansCursor",t.SORT="spansSort"}(n||(n={}))},"./app/views/starfish/views/spanSummaryPage/index.tsx":(t,e,a)=>{a.r(e),a.d(e,{Block:()=>me,BlockContainer:()=>ye,default:()=>_e});var n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/query-string/index.js")),r=a("./app/components/breadcrumbs.tsx"),i=a("./app/components/layouts/thirds.tsx"),o=a("./app/components/organizations/pageFilters/container.tsx"),l=a("./app/components/panels/panel.tsx"),p=a("./app/components/panels/panelBody.tsx"),c=a("./app/components/questionTooltip.tsx"),d=a("./app/locale.tsx"),u=a("./app/styles/space.tsx"),m=a("./app/utils/discover/eventView.tsx"),h=a("./app/utils/performance/contexts/pageError.tsx"),g=a("./app/utils/useOrganization.tsx"),f=a("./app/utils/withDomainRequired.tsx"),y=a("./app/views/starfish/colours.tsx"),v=a("./app/views/starfish/components/chart.tsx"),x=a("./app/views/starfish/components/chartPanel.tsx"),S=a("./app/views/starfish/components/datePicker.tsx");const Z=(0,n.Z)("div",{target:"e1enucjs0"})("padding:",(0,u.D)(1),";border-radius:",(t=>t.theme.borderRadius),";overflow-x:auto;white-space:pre-wrap;");var _=a("./app/views/starfish/types.tsx"),w=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const b=(t,e)=>{let a="";return t.split("").map(((n,s)=>{a+=n;let r=null;if(a===e.action?r=(0,w.BX)(N,{children:[e.action," "]},s):a===e.domain?r=(0,w.BX)(T,{children:[e.domain," "]},s):P.has(a)?r=(0,w.tZ)(E,{children:a},s):["(",")"].includes(a)?r=(0,w.tZ)(D,{children:a},s):" "===n||"\n"===n||")"===t[s+1]?r=a:"%s"===a?r=(0,w.tZ)(M,{children:a}):s===t.length-1&&(r=a),r){a="";const t=r;return r=null,t}return null}))},P=new Set(["ADD","ALL","ALTER","COLUMN","TABLE","AND","ANY","AS","ASC","BACKUP","DATABASE","BETWEEN","CASE","CHECK","CONSTRAINT","CREATE","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","EXEC","EXISTS","FOREIGN","KEY","FROM","FULL","OUTER","INNER","LEFT","RIGHT","ORDER","ON","LIMIT","WHERE","COUNT","JOIN","GROUP","BY","HAVING","UPDATE"]),N=(0,n.Z)("b",{target:"e1sm9bxn4"})("color:",(t=>t.theme.blue400),";"),T=(0,n.Z)("b",{target:"e1sm9bxn3"})("color:",(t=>t.theme.green400),";margin-right:-",(0,u.D)(.5),";"),M=(0,n.Z)("b",{target:"e1sm9bxn2"})("color:",(t=>t.theme.red400),";margin-right:-",(0,u.D)(.5),";"),E=(0,n.Z)("b",{target:"e1sm9bxn1"})("color:",(t=>t.theme.yellow400),";"),D=(0,n.Z)("b",{target:"e1sm9bxn0"})("color:",(t=>t.theme.pink400),";"),{SPAN_DESCRIPTION:C,SPAN_ACTION:A,SPAN_DOMAIN:L}=_.SpanMetricsFields;function F(t){let{spanMeta:e}=t;return e["span.op"].startsWith("db")?(0,w.tZ)($,{spanMeta:e}):(0,w.tZ)(j,{children:e[C]})}function $(t){let{spanMeta:e}=t;return(0,w.tZ)(k,{children:(0,w.tZ)(Z,{children:b(e[C]||"",{action:e[A]||"",domain:e[L]||""})})})}F.displayName="SpanDescription",$.displayName="DatabaseSpanDescription";const k=(0,n.Z)("div",{target:"elfaq7i1"})("font-size:",(t=>t.theme.fontSizeMedium),";"),j=(0,n.Z)("div",{target:"elfaq7i0"})({name:"1sdjnkx",styles:"word-break:break-word"});var I=a("./app/utils/discover/styles.tsx"),O=a("./app/utils/formatters.tsx");function B(t){let{count:e,containerProps:a}=t;return(0,w.tZ)(I.Hw,{...a,children:(0,O.Du)(e)})}B.displayName="CountCell";var R=a("./app/views/starfish/components/tableCells/durationCell.tsx"),q=a("./app/views/starfish/components/tableCells/throughputCell.tsx"),z=a("./app/views/starfish/components/tableCells/timeSpentCell.tsx"),X=a("./app/utils/discover/types.tsx"),V=a("./app/utils/useLocation.tsx"),W=a("./app/views/starfish/utils/useSpansQuery.tsx");const{SPAN_GROUP:Q}=_.SpanMetricsFields,H=function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"span-metrics";const s=(0,V.T)(),r=t?function(t,e,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const s=t.group.replaceAll("-","").slice(-16);return m.ZP.fromNewQueryWithLocation({name:"",query:`${Q}:${s}${a?.transactionName?` transaction:${a?.transactionName}`:""}${a?.["transaction.method"]?` transaction.method:${a?.["transaction.method"]}`:""}`,fields:n,dataset:X.as.SPANS_METRICS,version:2},e)}(t,s,e,a):void 0,i=Boolean(t?.group)&&Object.values(e).every((t=>Boolean(t))),o=(0,W.bB)({eventView:r,initialData:[],enabled:i,referrer:n});return{...o,data:o?.data?.[0]??{}}};var U=a("../node_modules/lodash/keyBy.js"),G=a.n(U),Y=a("./app/components/charts/utils.tsx"),K=a("./app/utils/usePageFilters.tsx"),J=a("./app/views/starfish/utils/constants.tsx");const{SPAN_GROUP:tt}=_.SpanMetricsFields,et=function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"span-metrics-series";const s=(0,K.Z)(),r=t?function(t,e,a,n){const s=t.group.replaceAll("-","").slice(-16);return m.ZP.fromNewQueryWithPageFilters({name:"",query:`${tt}:${s}${n?.transactionName?` transaction:${n?.transactionName}`:""}${n?.["transaction.method"]?` transaction.method:${n?.["transaction.method"]}`:""}`,fields:[],yAxis:a,dataset:X.as.SPANS_METRICS,interval:(0,Y.ZS)(e.datetime,J.R),version:2},e)}(t,s.selection,a,e):void 0,i=Boolean(t?.group)&&Object.values(e).every((t=>Boolean(t))),o=(0,W.bB)({eventView:r,initialData:[],referrer:n,enabled:i}),l=G()(a.map((t=>({seriesName:t,data:(o?.data??[]).map((e=>({value:e[t],name:e.interval})))}))),"seriesName");return{...o,data:l}};var at=a("./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts"),nt=a("./app/views/starfish/utils/extractRoute.tsx");const st={api:(0,d.t)("API Module"),database:(0,d.t)("DB Module"),"endpoint-overview":(0,d.t)("Endpoint Overview"),"span-summary":(0,d.t)("Span Summary"),"web-service":(0,d.t)("Web Service")};var rt=a("./app/views/starfish/views/queryParameters.tsx"),it=a("./app/views/starfish/views/spans/types.tsx"),ot=a("../node_modules/react/index.js"),lt=a("../node_modules/lodash/omit.js"),pt=a.n(lt),ct=a("./app/utils/useRouter.tsx"),dt=a("./app/views/starfish/components/detailPanel.tsx"),ut=a("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),mt=a("./app/views/starfish/components/samplesTable/common.tsx"),ht=a("../node_modules/moment/moment.js"),gt=a.n(ht),ft=a("./app/utils/queryClient.tsx"),yt=a("./app/utils/tokenizeSearch.tsx"),vt=a("./app/utils/useApi.tsx"),xt=a("./app/views/starfish/utils/getDateConditions.tsx");const{SPAN_SELF_TIME:St,SPAN_GROUP:Zt}=_.SpanIndexedFields,_t=t=>{const e=(0,vt.Z)(),a=(0,K.Z)(),{groupId:n,transactionName:r,transactionMethod:i}=t,o=(0,V.T)(),l=new yt.MY([`${Zt}:${n}`,`transaction:${r}`,`transaction.method:${i}`]),p=(0,xt.x)(a.selection),{isLoading:c,data:d}=et({group:n},{transactionName:r,"transaction.method":i},[`p95(${St})`],"api.starfish.sidebar-span-metrics"),u=(0,v.yX)([d?.[`p95(${St})`]]);return(0,ft.aM)({queryKey:["span-samples",n,r,p.statsPeriod,p.start,p.end],queryFn:async()=>{const{data:t}=await e.requestPromise(`/api/0/organizations/sentry/spans-samples/?${s.stringify({...p,utc:o.query.utc,lowerBound:0,firstBound:u*(1/3),secondBound:u*(2/3),upperBound:u,query:l.formatString()})}`);return t?.map((t=>({...t,timestamp:gt()(t.timestamp).format(W.zT)}))).sort(((t,e)=>e[St]-t[St]))},refetchOnWindowFocus:!1,enabled:Boolean(n&&r&&!c),initialData:[]})},{SPAN_SELF_TIME:wt,SPAN_OP:bt}=_.SpanMetricsFields;function Pt(t){let{groupId:e,transactionName:a,onClickSample:n,onMouseLeaveSample:s,onMouseOverSample:r,highlightedSpanId:i,transactionMethod:o}=t;const l=(0,ut.u)(),{setPageError:p}=(0,h.De)(),c=(t,e)=>(0,mt.k)(t,e)?{symbol:"path://M 0 0 V -8 L 5 0 L 0 8 L -5 0 L 0 -8",color:l.gray300}:t>e?{symbol:"path://M 5 4 L 0 -4 L -5 4 L 5 4",color:l.red300}:{symbol:"path://M -5 -4 L 0 4 L 5 -4 L -5 -4",color:l.green300},{isLoading:u,data:m,error:g}=et({group:e},{transactionName:a,"transaction.method":o},[`p95(${wt})`],"api.starfish.sidebar-span-metrics-chart"),{data:f,error:x}=H({group:e},{transactionName:a,"transaction.method":o},[`p95(${wt})`,bt],"api.starfish.span-summary-panel-samples-table-p95"),S=f?.[`p95(${wt})`]||0,{data:Z,isLoading:_,isRefetching:b}=_t({groupId:e,transactionName:a,transactionMethod:o}),P={seriesName:"Baseline P95",data:[],markLine:{data:[{valueDim:"x",yAxis:S}],symbol:["none","none"],lineStyle:{color:l.gray400},emphasis:{disabled:!0},label:{fontSize:11,position:"insideEndBottom",formatter:()=>"Baseline P95"}}},N=Z.map((t=>{let{timestamp:e,[wt]:a,"transaction.id":n,span_id:s}=t;return{data:[{name:e,value:a}],symbol:c(a,S).symbol,color:c(a,S).color,symbolSize:s===i?15:10,seriesName:n.substring(0,8)}})),T=(t,e)=>Z.find((a=>a.timestamp===t&&a[wt]===e));return(g||x)&&p((0,d.t)("An error has occured while loading chart data")),(0,w.BX)("div",{onMouseLeave:()=>{s&&s()},children:[(0,w.tZ)("h5",{children:it.F.p95}),(0,w.tZ)(v.ZP,{statsPeriod:"24h",height:140,onClick:t=>{if("scatter"===t?.componentSubType&&n){const[e,a]=t.value,s=T(e,a);s&&n(s)}},onHighlight:t=>{const{seriesIndex:e}=t.batch[0],a=e>1;if(a&&r){const t=N?.[e-2]?.data[0],{name:a,value:n}=t,s=T(a,n);s&&r(s)}!a&&s&&s()},aggregateOutputFormat:"duration",data:[m?.[`p95(${wt})`],P],start:"",end:"",loading:u,scatterPlot:_||b?void 0:N,utc:!1,chartColors:[y.Tn,"black"],isLineChart:!0,definedAxisTicks:4})]})}Pt.displayName="DurationChart";const Nt=Pt,{SPAN_SELF_TIME:Tt}=_.SpanMetricsFields;function Mt(t){const{groupId:e,transactionName:a,transactionMethod:n}=t,{setPageError:s}=(0,h.De)(),{data:r,error:i}=H({group:e},{transactionName:a,"transaction.method":n},["sps()",`sum(${Tt})`,`p95(${Tt})`,"time_spent_percentage(local)"],"api.starfish.span-summary-panel-metrics"),o={textAlign:"left"};return i&&s(i.message),(0,w.BX)(ye,{children:[(0,w.tZ)(me,{title:it.F.throughput,children:(0,w.tZ)(q.Z,{containerProps:{style:o},throughputPerSecond:r?.["sps()"]})}),(0,w.tZ)(me,{title:it.F.p95,children:(0,w.tZ)(R.Z,{containerProps:{style:o},milliseconds:r?.[`p95(${Tt})`]})})]})}Mt.displayName="SampleInfo";const Et=Mt;var Dt=a("./app/components/button.tsx"),Ct=a("./app/utils/analytics.tsx"),At=a("./app/utils/performanceForSentry/index.tsx"),Lt=a("../node_modules/react-router/es/index.js"),Ft=a("./app/components/gridEditable/index.tsx"),$t=a("./app/views/starfish/components/textAlign.tsx");const kt=[{key:"transaction_id",name:"Event ID",width:200},{key:"duration",name:"Span Duration",width:200},{key:"p95_comparison",name:"Compared to baseline",width:200}];function jt(t){let{isLoading:e,data:a,p95:n,highlightedSpanId:s,onMouseLeaveSample:r,onMouseOverSample:i}=t;const o=(0,V.T)();return(0,w.tZ)("div",{onMouseLeave:function(){r&&r()},children:(0,w.tZ)(Ft.ZP,{isLoading:e,data:a,columnOrder:kt,columnSortBy:[],grid:{renderHeadCell:function(t){return"p95_comparison"===t.key||"duration"===t.key?(0,w.tZ)($t.Dq,{children:(0,w.tZ)($t._F,{children:t.name})}):(0,w.tZ)($t._F,{children:t.name})},renderBodyCell:function(t,e){const a={style:e.span_id===s?{fontWeight:"bold"}:{},onMouseEnter:()=>function(t){i&&i(t)}(e)};return"transaction_id"===t.key?(0,w.tZ)(Lt.Link,{to:`/performance/${e.project}:${e["transaction.id"]}#span-${e.span_id}`,...a,children:e["transaction.id"].slice(0,8)}):"duration"===t.key?(0,w.tZ)(R.Z,{containerProps:a,milliseconds:e["span.self_time"]}):"p95_comparison"===t.key?(0,w.tZ)(mt.f,{containerProps:a,duration:e["span.self_time"],p95:n}):(0,w.tZ)("span",{...a,children:e[t.key]})}},location:o})})}jt.displayName="SpanSamplesTable";var It=a("./app/utils/discover/discoverQuery.tsx"),Ot=a("./app/views/starfish/utils/retryHandlers.tsx");const{SPAN_SELF_TIME:Bt,SPAN_OP:Rt}=_.SpanMetricsFields;function qt(t){let{groupId:e,transactionName:a,highlightedSpanId:n,onMouseLeaveSample:s,onMouseOverSample:r,transactionMethod:i}=t;const{data:o,isFetching:l}=H({group:e},{transactionName:a,"transaction.method":i},[`p95(${Bt})`,Rt],"api.starfish.span-summary-panel-samples-table-p95"),p=(0,g.Z)(),{setPageError:c}=(0,h.De)(),{data:u,isFetching:f,error:y,refetch:v}=_t({groupId:e,transactionName:a,transactionMethod:i}),{data:x,isFetching:S,error:Z}=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"use-transactions";const a=(0,V.T)(),{slug:n}=(0,g.Z)(),s=m.ZP.fromNewQueryWithLocation({fields:["id","timestamp","project.name","transaction.duration"],name:"Transactions",version:2,query:`id:[${t.join(",")}]`},a),r=Boolean(t.length),i=(0,It._)({eventView:s,location:a,orgSlug:n,referrer:e,options:{enabled:r,refetchOnWindowFocus:!1,retry:Ot.V,retryDelay:Ot.P,staleTime:1/0}}),o=i.data?.data??[];return r?{...i,data:o}:{isFetching:!1,isLoading:!1,error:null,data:[]}}(u.map((t=>t["transaction.id"])),"api.starfish.span-summary-panel-samples-table-transactions"),[_,b]=(0,ot.useState)(!1);(0,ot.useEffect)((()=>{S||f?b(!1):_||((0,Ct.Gi)("starfish.samples.loaded",{organization:p,count:x?.length??0}),b(!0))}),[_,f,x,S,p]);const P=G()(x,"id"),N=!f&&0===u.length,T=l||f||!N&&S;return(y||Z)&&c((0,d.t)("An error has occured while loading the samples table")),(0,w.BX)(ot.Fragment,{children:[(0,w.tZ)(At.oF,{id:"SpanSummary.Samples.SampleTable",hasData:u.length>0,children:(0,w.tZ)(jt,{onMouseLeaveSample:s,onMouseOverSample:r,highlightedSpanId:n,data:u.map((t=>({...t,op:o[Rt],transaction:P[t["transaction.id"]]}))),isLoading:T,p95:o?.[`p95(${Bt})`]})}),(0,w.tZ)(Dt.zx,{onClick:()=>v(),children:(0,d.t)("Load More Samples")})]})}qt.displayName="SampleTable";const zt=qt;function Xt(t){let{groupId:e,transactionName:a,transactionMethod:n}=t;const s=(0,ct.Z)(),[r,i]=(0,ot.useState)(void 0),o=e&&a&&n?`${e}:${a}:${n}`:void 0;return(0,w.tZ)(h.V_,{children:(0,w.BX)(dt.Z,{detailKey:o,onClose:()=>{s.push({pathname:s.location.pathname,query:pt()(s.location.query,"transaction","transactionMethod")})},children:[(0,w.tZ)("h3",{children:`${n} ${a}`}),(0,w.tZ)(h.YY,{}),(0,w.tZ)(Et,{groupId:e,transactionName:a,transactionMethod:n}),(0,w.tZ)(Nt,{groupId:e,transactionName:a,transactionMethod:n,onClickSample:t=>{s.push(`/performance/${t.project}:${t["transaction.id"]}/#span-${t.span_id}`)},onMouseOverSample:t=>i(t.span_id),onMouseLeaveSample:()=>i(void 0),highlightedSpanId:r}),(0,w.tZ)(zt,{highlightedSpanId:r,transactionMethod:n,onMouseLeaveSample:()=>i(void 0),onMouseOverSample:t=>i(t.span_id),groupId:e,transactionName:a})]})})}Xt.displayName="SampleList";var Vt=a("./app/components/links/link.tsx"),Wt=a("./app/components/pagination.tsx"),Qt=a("./app/components/truncate.tsx"),Ht=a("./app/utils/discover/fieldRenderers.tsx"),Ut=a("./app/views/starfish/components/tableCells/renderHeadCell.tsx");const{SPAN_SELF_TIME:Gt,SPAN_GROUP:Yt}=_.SpanMetricsFields,Kt=function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"api.starfish.span-transaction-metrics";const n=(0,V.T)(),{transactions:s,sorts:r}=e,i=function(t,e,a,n){const s=t.group.replaceAll("-","").slice(-16),r=new yt.MY("");r.addFilterValues(Yt,[s]),r.addFilterValues("transaction.op",["http.server"]),a.length>0&&r.addFilterValues("transaction",a);const i=m.ZP.fromNewQueryWithLocation({name:"",query:r.formatString(),fields:["transaction","transaction.method","sps()","sps_percent_change()",`sum(${Gt})`,`p95(${Gt})`,`percentile_percent_change(${Gt}, 0.95)`,"time_spent_percentage(local)","transaction.op","http_error_count()","http_error_count_percent_change()"],orderby:"-time_spent_percentage_local",dataset:X.as.SPANS_METRICS,version:2},e);return n&&(i.sorts=n),i}(t,n,s??[],r);return(0,W.RX)({eventView:i,initialData:[],enabled:Boolean(t),referrer:a})};function Jt(t){let{span:e,openSidebar:a,onClickTransaction:n,endpoint:s,endpointMethod:r,sort:i}=t;const o=(0,V.T)(),l=(0,g.Z)(),{data:p=[],meta:c,isLoading:u,pageLinks:m}=Kt(e,{transactions:s?[s]:void 0,sorts:[i]}),h=p.map((t=>({transaction:t.transaction,transactionMethod:t["transaction.method"],metrics:t})));return(0,w.BX)(ot.Fragment,{children:[(0,w.tZ)(At.oF,{id:"SpanSummary.SpanTransactionsTable",hasData:p.length>0,children:(0,w.tZ)(Ft.ZP,{isLoading:u,data:h,columnOrder:ee(e),columnSortBy:[],grid:{renderHeadCell:t=>(0,Ut.W)({column:t,sort:i,location:o}),renderBodyCell:(t,i)=>"transaction"===t.key?(0,w.tZ)(te,{endpoint:s,endpointMethod:r,span:e,row:i,column:t,openSidebar:a,onClickTransactionName:n,location:o}):c&&c?.fields?(0,Ht.Js)(t.key,c.fields,!1)(i.metrics,{location:o,organization:l,unit:c.units?.[t.key]}):i[t.key]},location:o})}),(0,w.BX)(ae,{children:[s&&(0,w.tZ)(Dt.zx,{to:{pathname:o.pathname,query:pt()(o.query,"endpoint")},children:(0,d.t)("View More Endpoints")}),(0,w.tZ)(ne,{pageLinks:m})]})]})}function te(t){let{span:e,row:a,endpoint:n,endpointMethod:r,location:i}=t;const o=a.transactionMethod?`${a.transactionMethod} ${a.transaction}`:a.transaction;return(0,w.tZ)(ot.Fragment,{children:(0,w.tZ)(Vt.Z,{to:`/starfish/${(0,nt.G)(i)??"spans"}/span/${encodeURIComponent(e.group)}?${s.stringify({...i.query,endpoint:n,endpointMethod:r,transaction:a.transaction,transactionMethod:a.transactionMethod})}`,children:(0,w.tZ)(Qt.Z,{value:o,maxLength:75})})})}Jt.displayName="SpanTransactionsTable",te.displayName="TransactionCell";const ee=t=>[{key:"transaction",name:"Found In Endpoints",width:Ft.z7},{key:"sps()",name:it.F.throughput,width:Ft.z7},{key:"sps_percent_change()",name:it.F.change,width:Ft.z7},{key:`p95(${_.SpanMetricsFields.SPAN_SELF_TIME})`,name:it.F.p95,width:Ft.z7},{key:`percentile_percent_change(${_.SpanMetricsFields.SPAN_SELF_TIME}, 0.95)`,name:it.F.change,width:Ft.z7},...t?.["span.op"]?.startsWith("http")?[{key:"http_error_count()",name:it.F.errorCount,width:Ft.z7},{key:"http_error_count_percent_change()",name:it.F.change,width:Ft.z7}]:[],{key:"time_spent_percentage(local)",name:it.F.timeSpent,width:Ft.z7}],ae=(0,n.Z)("div",{target:"eo6is321"})({name:"1eoy87d",styles:"display:flex;justify-content:space-between"}),ne=(0,n.Z)(Wt.Z,{target:"eo6is320"})({name:"1wh5xum",styles:"margin-top:0;margin-left:auto"});function se(t){return Ut.q.has(t.field)}const{SPAN_SELF_TIME:re,SPAN_OP:ie,SPAN_DESCRIPTION:oe,SPAN_ACTION:le,SPAN_DOMAIN:pe}=_.SpanMetricsFields,ce={kind:"desc",field:"time_spent_percentage(local)"};function de(t){let{params:e,location:a}=t;const n=(0,g.Z)(),{groupId:p}=e,{transaction:c,transactionMethod:u,endpoint:Z,endpointMethod:_}=a.query,b=Z?{transactionName:Z,"transaction.method":_}:{},P=(0,m.vp)(a.query[rt.o.SORT]).filter(se)[0]??ce;_&&b&&(b["transaction.method"]=_);const{data:N,isLoading:T}=H({group:p},b,[ie,oe,le,pe,"count()","sps()",`sum(${re})`,`p95(${re})`,"time_spent_percentage()","http_error_count()"],"api.starfish.span-summary-page-metrics"),M=Object.assign({group:p},N),{isLoading:E,data:D}=et({group:p},b,[`p95(${re})`,"sps()","http_error_count()"],"api.starfish.span-summary-page-metrics-chart");(0,v.K4)([!E]);const C={seriesName:M?.[ie]?.startsWith("db")?"Queries":"Requests",data:D?.["sps()"].data},A=we(a,M,!0),L=we(a,M),$=[];$.push({label:(0,d.t)("Web Service"),to:(0,f.D)(`/organizations/${n.slug}/starfish/`)});const k=(0,nt.G)(a);return k&&st[k]&&$.push({label:st[k],to:(0,f.D)(`/organizations/${n.slug}/starfish/${k??"spans"}/?${s.stringify({endpoint:Z,"http.method":_})}`)}),$.push({label:A}),(0,w.tZ)(i.T3,{children:(0,w.tZ)(o.Z,{children:(0,w.BX)(h.V_,{children:[(0,w.tZ)(i.h4,{children:(0,w.BX)(i.oB,{children:[!T&&(0,w.tZ)(r.Z,{crumbs:$}),(0,w.tZ)(i.Dx,{children:_&&Z?`${_} ${Z}`:!T&&A})]})}),(0,w.tZ)(i.uT,{children:(0,w.BX)(i.or,{fullWidth:!0,children:[(0,w.tZ)(h.YY,{}),(0,w.BX)(ye,{children:[(0,w.tZ)(ue,{children:(0,w.tZ)(S.Z,{})}),(0,w.BX)(ye,{children:[(0,w.tZ)(me,{title:(0,d.t)("Operation"),children:M?.[ie]}),(0,w.tZ)(me,{title:(0,d.t)("Throughput"),description:(0,d.t)("Throughput of this span per second"),children:(0,w.tZ)(q.Z,{throughputPerSecond:N?.["sps()"]})}),(0,w.tZ)(me,{title:(0,d.t)("Duration (P95)"),description:(0,d.t)("Time spent in this span"),children:(0,w.tZ)(R.Z,{milliseconds:N?.[`p95(${re})`]})}),M?.[ie]?.startsWith("http")&&(0,w.tZ)(me,{title:(0,d.t)("5XX Responses"),description:(0,d.t)("5XX responses in this span"),children:(0,w.tZ)(B,{count:N?.["http_error_count()"]})}),(0,w.tZ)(me,{title:(0,d.t)("Time Spent"),description:(0,d.t)("Time spent in this span as a proportion of total application time"),children:(0,w.tZ)(z.z,{timeSpentPercentage:N?.["time_spent_percentage()"],totalSpanTime:N?.[`p95(${re})`]})})]})]}),M?.[oe]&&(0,w.BX)(ye,{children:[(0,w.tZ)(me,{children:(0,w.tZ)(l.Z,{children:(0,w.tZ)(xe,{children:(0,w.BX)(ve,{children:[(0,w.tZ)(Ze,{children:L}),(0,w.tZ)(F,{spanMeta:M})]})})})}),(0,w.tZ)(me,{children:(0,w.tZ)(x.Z,{title:it.F.throughput,children:(0,w.tZ)(v.ZP,{statsPeriod:"24h",height:140,data:[C],start:"",end:"",loading:E,utc:!1,chartColors:[y.SQ],isLineChart:!0,definedAxisTicks:4,aggregateOutputFormat:"rate",tooltipFormatterOptions:{valueFormatter:t=>(0,at.Z)(t)}})})}),(0,w.tZ)(me,{children:(0,w.tZ)(x.Z,{title:it.F.p95,children:(0,w.tZ)(v.ZP,{statsPeriod:"24h",height:140,data:[D?.[`p95(${re})`]],start:"",end:"",loading:E,utc:!1,chartColors:[y.Tn],isLineChart:!0,definedAxisTicks:4})})}),M?.[ie]?.startsWith("http")&&(0,w.tZ)(me,{children:(0,w.tZ)(x.Z,{title:it.F.errorCount,children:(0,w.tZ)(v.ZP,{statsPeriod:"24h",height:140,data:[D?.["http_error_count()"]],start:"",end:"",loading:E,utc:!1,chartColors:[y.eO],isLineChart:!0,definedAxisTicks:4})})})]}),M&&(0,w.tZ)(Jt,{span:M,sort:P,endpoint:Z,endpointMethod:_}),(0,w.tZ)(Xt,{groupId:M.group,transactionName:c,transactionMethod:u})]})})]})})})}de.displayName="SpanSummaryPage";const ue=(0,n.Z)("div",{target:"eby1jon8"})("display:flex;flex-direction:row;gap:",(0,u.D)(1),";align-items:center;flex:1;");function me(t){let{title:e,description:a,children:n}=t;return(0,w.BX)(Se,{children:[(0,w.BX)(he,{children:[e,a&&(0,w.tZ)(fe,{children:(0,w.tZ)(c.Z,{size:"sm",position:"right",title:a})})]}),(0,w.tZ)(ge,{children:n})]})}me.displayName="Block";const he=(0,n.Z)("h3",{target:"eby1jon7"})("color:",(t=>t.theme.gray300),";font-size:",(t=>t.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,u.D)(1),";white-space:nowrap;"),ge=(0,n.Z)("h4",{target:"eby1jon6"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),fe=(0,n.Z)("span",{target:"eby1jon5"})("margin-left:",(0,u.D)(1),";"),ye=(0,n.Z)("div",{target:"eby1jon4"})("display:flex;&>div:last-child{padding-right:",(0,u.D)(1),";}padding-bottom:",(0,u.D)(2),";"),ve=(0,n.Z)("div",{target:"eby1jon3"})("width:100%;padding:",(0,u.D)(1),";font-size:1rem;line-height:1.2;"),xe=(0,n.Z)(p.Z,{target:"eby1jon2"})("padding:",(0,u.D)(2),";height:208px;"),Se=(0,n.Z)("div",{target:"eby1jon1"})("padding-right:",(0,u.D)(4),";flex:1;"),Ze=(0,n.Z)("h4",{target:"eby1jon0"})({name:"1qszq24",styles:"font-size:1rem;font-weight:600;line-height:1.2"}),_e=de,we=(t,e,a)=>{const n=(0,nt.G)(t);if("api"===n)return a?(0,d.t)("URL Request Summary"):(0,d.t)("URL Request");if("database"===n)return a?(0,d.t)("Query Summary"):(0,d.t)("Query");const s=e[ie];let r;return s?.startsWith("http")&&(r=a?(0,d.t)("URL Request Summary"):(0,d.t)("URL Request")),s?.startsWith("db")&&(r=a?(0,d.t)("Query Summary"):(0,d.t)("Query")),s?.startsWith("serialize")&&(r=a?(0,d.t)("Serializer Summary"):(0,d.t)("Serializer")),s?.startsWith("task")&&(r=a?(0,d.t)("Task Summary"):(0,d.t)("Task")),r||(r=a?(0,d.t)("Span Summary"):(0,d.t)("Span Description")),r}}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spanSummaryPage_index_tsx.cea9a7a8c0bd808f8d0dedceae158698.js.map