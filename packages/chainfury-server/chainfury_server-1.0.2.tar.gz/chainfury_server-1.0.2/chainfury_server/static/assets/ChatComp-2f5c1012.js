import{r as i,n as F,a0 as P,a1 as _,j as s,l as r,F as E}from"./index-35325410.js";import{m as $}from"./index-0223be06.js";const T=({chatId:o})=>{const[l,c]=i.useState(!1),[t,d]=i.useState([]),[n,f]=i.useState(""),[g,h]=i.useState(!1),{chat_id:y}=F(),[C]=P(),[x,b]=i.useState([]),[p,m]=i.useState(!1),[v]=_(),[N,w]=i.useState(null);i.useEffect(()=>{o&&(d([]),b([]),w($(30)),c(!1))},[o]),i.useEffect(()=>{n!=null&&n.trim()&&k()},[t]);const k=async()=>{m(!1),h(!0),C({chatbot_id:o??y??"",new_message:n,chat_history:x,session_id:N??""}).unwrap().then(e=>{d([...t,{id:e==null?void 0:e.prompt_id,message:e==null?void 0:e.result,isSender:!1}]),m(!0)}).catch(e=>{var a,S;(a=e==null?void 0:e.data)!=null&&a.detail&&d([...t,{id:t.length+1,message:(S=e==null?void 0:e.data)==null?void 0:S.detail,isSender:!1}])}).finally(()=>{const e=document.querySelector(".chatContainer");e&&(e.scrollTop=e.scrollHeight-300),b([...x,n]),h(!1)}),f("")},u=(e,a)=>{v({prompt_id:a,score:e}).finally(()=>{m(!1)})};return s("div",{className:"absolute bg-light-system-bg-primary z-[100000] right-0 bottom-0 ",children:r("div",{className:`flex flex-col ${l&&!o?"w-screen":""} ${o?"max-h-[450px]":"max-h-screen"} border border-light-neutral-grey-200 shadow-sm rounded-md  regular250 overflow-hidden`,children:[r("div",{onClick:()=>{l||c(!0)},className:"cursor-pointer flex justify-between chatHeader semiBold400 p-[8px] border-b bg-light-primary-blue-400 text-white",children:["The Bot",l?s("span",{onClick:()=>{c(!1)},className:"cursor-pointer",children:"----"}):""]}),l?r(E,{children:[s("div",{className:"overflow-scroll h-[420px] min-w-[350px] p-[16px] pb-[40px] chatContainer",children:t.map((e,a)=>s("div",{className:`chat ${e.isSender?"nbx-chat-end":"nbx-chat-start"}`,children:r("div",{className:`flex flex-col ${!(e!=null&&e.isSender)&&p?"rounded-b-[8px!important] overflow-hidden":""}`,children:[s("div",{className:`chat-bubble ${!(e!=null&&e.isSender)&&p?"rounded-br-[0px!important]":""}`,children:e.message}),!(e!=null&&e.isSender)&&p&&a===(t==null?void 0:t.length)-1?r("div",{className:"bg-light-neutral-grey-300 p-[8px] flex gap-[8px] text-light-neutral-grey-900 items-center",children:[s("span",{children:"Rate this answer:"}),s("span",{onClick:()=>{u(3,e.id.toString())},className:"text-[20px] cursor-pointer",children:"😀"}),s("span",{onClick:()=>{u(2,e.id.toString())},className:"text-[20px] cursor-pointer",children:"😐"}),s("span",{onClick:()=>{u(1,e.id.toString())},className:"text-[20px] cursor-pointer",children:"😞"})]}):""]})},a))}),s("div",{className:"p-[8px]",children:s("input",{value:g?"Thinking...":n,disabled:g,onChange:e=>{f(e.target.value)},onKeyPress:e=>{e.key==="Enter"&&(n!=null&&n.trim())&&d([...t,{id:t.length+1,message:n,isSender:!0}])},type:"text",placeholder:"Write your message!",className:"w-full focus:outline-none pl bg-light-system-bg-secondary rounded-md py-3"})})]}):""]})})};export{T as default};
