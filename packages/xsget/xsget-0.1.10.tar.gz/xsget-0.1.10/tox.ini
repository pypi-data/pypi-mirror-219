[tox]
isolated_build = True
envlist = py3{8,9,10,11}

[testenv]
description = testing against {basepython}
deps = pipenv
commands =
    pipenv install --dev
    pipenv run pytest --numprocesses auto --hide-run-results

[testenv:cover]
description = generate code coverage report in html
basepython = python3.11
deps = pipenv
commands =
    pipenv install --dev
    pipenv run pytest --numprocesses auto --cov-append --cov=xsget --cov-report term-missing --cov-report html {toxinidir}/tests
    pipenv run coverage combine

[testenv:doc]
description = generate sphinx documentation in html
basepython = python3.11
deps = pipenv
commands =
    pipenv install --dev
    pipenv run sphinx-build {toxinidir}/docs/source/ {toxinidir}/docs/build/html

[testenv:gettext]
description = update pot/po/mo files
basepython = python3.11
allowlist_externals =
    pygettext3
    msgmerge
    msgfmt
commands =
    pygettext3 -d xstxt -o {toxinidir}/locales/xstxt.pot {toxinidir}/xsget/
    msgmerge --update {toxinidir}/locales/en/LC_MESSAGES/xstxt.po {toxinidir}/locales/xstxt.pot
    msgmerge --update {toxinidir}/locales/zh/LC_MESSAGES/xstxt.po {toxinidir}/locales/xstxt.pot
    msgfmt -o {toxinidir}/locales/en/LC_MESSAGES/xstxt.mo {toxinidir}/locales/en/LC_MESSAGES/xstxt.po
    msgfmt -o {toxinidir}/locales/zh/LC_MESSAGES/xstxt.mo {toxinidir}/locales/zh/LC_MESSAGES/xstxt.po
