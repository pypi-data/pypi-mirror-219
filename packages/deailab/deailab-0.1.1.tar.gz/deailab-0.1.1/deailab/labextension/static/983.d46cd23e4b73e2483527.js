(self.webpackChunkdeailab=self.webpackChunkdeailab||[]).push([[983],{4983:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Ie});var o=a(9993),n=a(4238);async function l(e="",t={}){const a=n.ServerConnection.makeSettings(),l=o.URLExt.join(a.baseUrl,"bacalhau-lab",e);let s;try{s=await n.ServerConnection.makeRequest(l,t,a)}catch(e){throw new n.ServerConnection.NetworkError(e)}let r=await s.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new n.ServerConnection.ResponseError(s,r.message||r);return r}var s=a(5350),r=a(4470),i=a(7930);const c=new i.Token("bhl:IBhlViewerTracker","A widget tracker for bhl file."),d=new i.Token("bhl:IDeAIProtocol","Available protocol data");var u=a(2189);const m=new u.LabIcon({name:"deailab:bhl-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 64 32" fill="none">\n<path d="M32.9698 6.2964L28.6644 0H35.2768L39.5821 6.2964H32.9698Z" fill="#0055FF"/>\n<path d="M46.1944 6.29639H39.582L48.1928 18.8855L39.582 31.4783H46.1944L54.8051 18.8855L46.1944 6.29639Z" fill="#33CCFF"/>\n<path d="M10.9177 18.8856L6.61233 12.5892H0L4.30536 18.8856L0 25.182H6.61233L10.9177 18.8856Z" fill="#0055FF"/>\n<path d="M30.585 23.9512L34.8903 17.6548H28.278L23.9727 23.9512H30.585Z" fill="#0055FF"/>\n<path d="M40.3343 22.0337C42.1602 22.0337 43.6405 20.5534 43.6405 18.7275C43.6405 16.9015 42.1602 15.4213 40.3343 15.4213C38.5084 15.4213 37.0281 16.9015 37.0281 18.7275C37.0281 20.5534 38.5084 22.0337 40.3343 22.0337Z" fill="#0055FF"/>\n<path d="M26.141 6.2964L21.8357 0H15.2233L19.5287 6.2964L10.918 18.8855L19.5287 31.4783H26.141L17.5303 18.8855L26.141 6.2964Z" fill="#33CCFF"/>\n<path d="M68.0297 6.29639H79.2963C82.0074 6.29639 84.0829 6.96497 85.387 8.1258C86.7609 9.35643 87.3928 10.8699 87.3928 12.8426C87.3928 15.4141 85.8095 17.0671 83.4511 17.879V17.9855C86.2319 18.7937 88.1348 21.119 88.1348 24.2158C88.1348 26.5742 87.3964 28.1942 85.916 29.4616C84.4723 30.7289 82.2535 31.4673 79.5792 31.4673H68.0333V6.29639H68.0297ZM78.6608 16.4353C80.8796 16.4353 82.3931 15.3773 82.3931 13.4083C82.3931 11.5422 81.0192 10.4511 78.7673 10.4511H73.1358V16.4353H78.6645H78.6608ZM73.1322 27.2428H79.0098C81.4747 27.2428 82.9515 25.8689 82.9515 23.8264C82.9515 21.4313 81.1919 20.2006 78.8665 20.2006H73.1285V27.2428H73.1322Z" fill="white"/>\n<path d="M102.244 29.4616H102.174C101.26 30.8355 99.9554 31.8898 96.8587 31.8898C93.1631 31.8898 90.5586 29.9539 90.5586 26.3612C90.5586 22.3828 93.7986 21.1154 97.8101 20.5533C100.804 20.1309 102.174 19.8848 102.174 18.5109C102.174 17.137 101.153 16.3619 99.1473 16.3619C96.8954 16.3619 95.8044 17.17 95.6611 18.8966H91.3998C91.5394 15.7263 93.8978 12.9455 99.1803 12.9455C104.463 12.9455 106.785 15.3737 106.785 19.5982V28.7857C106.785 30.1596 106.998 30.9678 107.416 31.2837V31.46H102.806C102.523 31.1074 102.347 30.2624 102.244 29.4543V29.4616ZM102.281 25.0975V22.3864C101.436 22.8787 100.132 23.1615 98.9379 23.4444C96.4399 24.0064 95.2056 24.5722 95.2056 26.262C95.2056 27.9518 96.3334 28.5506 98.0232 28.5506C100.771 28.5506 102.284 26.8608 102.284 25.1012L102.281 25.0975Z" fill="white"/>\n<path d="M109.64 22.4562C109.64 17.0708 113.159 12.9161 118.651 12.9161C123.335 12.9161 126.219 15.6271 126.854 19.5358H122.17C121.854 17.9525 120.62 16.7549 118.861 16.7549C115.973 16.7549 114.496 18.9737 114.496 22.4599C114.496 25.946 115.87 28.1648 118.791 28.1648C120.727 28.1648 122.101 27.1436 122.417 25.1011H127.027C126.711 28.94 123.717 32 118.894 32C113.189 32 109.636 27.8452 109.636 22.4599L109.64 22.4562Z" fill="white"/>\n<path d="M141.323 29.4616H141.253C140.338 30.8355 139.034 31.8898 135.937 31.8898C132.242 31.8898 129.637 29.9539 129.637 26.3612C129.637 22.3828 132.877 21.1154 136.889 20.5533C139.883 20.1309 141.253 19.8848 141.253 18.5109C141.253 17.137 140.232 16.3619 138.226 16.3619C135.974 16.3619 134.883 17.17 134.74 18.8966H130.479C130.618 15.7263 132.977 12.9455 138.259 12.9455C143.542 12.9455 145.863 15.3737 145.863 19.5982V28.7857C145.863 30.1596 146.076 30.9678 146.495 31.2837V31.46H141.885C141.602 31.1074 141.426 30.2624 141.323 29.4543V29.4616ZM141.36 25.0975V22.3864C140.515 22.8787 139.211 23.1615 138.017 23.4444C135.519 24.0064 134.284 24.5722 134.284 26.262C134.284 27.9518 135.412 28.5506 137.102 28.5506C139.85 28.5506 141.363 26.8608 141.363 25.1012L141.36 25.0975Z" fill="white"/>\n<path d="M149.667 6.29639H154.453V31.4673H149.667V6.29639Z" fill="white"/>\n<path d="M163.041 15.7667H163.147C164.452 13.8675 165.928 12.9161 168.393 12.9161C172.125 12.9161 174.623 15.7337 174.623 19.6753V31.471H169.837V20.3807C169.837 18.4447 168.709 17.0708 166.703 17.0708C164.591 17.0708 163.041 18.7606 163.041 21.2256V31.471H158.254V6.29639H163.041V15.7667Z" fill="white"/>\n<path d="M189.095 29.4616H189.025C188.11 30.8355 186.806 31.8898 183.709 31.8898C180.014 31.8898 177.409 29.9539 177.409 26.3612C177.409 22.3828 180.649 21.1154 184.661 20.5533C187.655 20.1309 189.025 19.8848 189.025 18.5109C189.025 17.137 188.004 16.3619 185.998 16.3619C183.746 16.3619 182.655 17.17 182.512 18.8966H178.25C178.39 15.7263 180.748 12.9455 186.031 12.9455C191.313 12.9455 193.635 15.3737 193.635 19.5982V28.7857C193.635 30.1596 193.848 30.9678 194.267 31.2837V31.46H189.657C189.374 31.1074 189.197 30.2624 189.095 29.4543V29.4616ZM189.131 25.0975V22.3864C188.286 22.8787 186.982 23.1615 185.788 23.4444C183.29 24.0064 182.056 24.5722 182.056 26.262C182.056 27.9518 183.184 28.5506 184.874 28.5506C187.622 28.5506 189.135 26.8608 189.135 25.1012L189.131 25.0975Z" fill="white"/>\n<path d="M208.667 31.4673V29.355H208.56C207.33 31.0081 205.919 31.9595 203.384 31.9595C199.369 31.9595 197.117 29.3881 197.117 25.4464V13.4046H201.871V24.6346C201.871 26.7468 202.822 27.9077 204.865 27.9077C207.116 27.9077 208.49 26.2178 208.49 23.8227V13.4009H213.277V31.4599H208.667V31.4673Z" fill="white"/>\n</svg>\n'});var h=a(3781),p=a(6029),_=a(7760),g=a(4483);const v={protocol:void 0,availableImages:[],dockerImage:void 0,customDockerImage:void 0,resources:{},polling:!1,resultAvailable:!1},f=(0,g.createSlice)({name:"deAIState",initialState:v,reducers:{reset:e=>v,load:(e,t)=>({...t.payload}),setDockerImage:(e,t)=>({...e,dockerImage:t.payload}),setCustomDockerImage:(e,t)=>({...e,customDockerImage:t.payload}),addCustomDockerImage:(e,t)=>({...e,availableImages:[...e.availableImages,t.payload],dockerImage:t.payload,customDockerImage:""}),addResource:(e,t)=>{const a=t.payload;return{...e,resources:{...e.resources,[a]:{type:"file",value:null,encryption:!0}}}},removeResource:(e,t)=>{const a=t.payload,o={...e.resources};return o[a]&&delete o[a],{...e,resources:o}},updateResource:(e,t)=>{const{id:a,resource:o}=t.payload,n={...e.resources};if(n[a]){const t={...n[a],...o};return{...e,resources:{...e.resources,[a]:t}}}return{...e}},cleanLog:e=>({...e,log:[]}),logError:(e,t)=>{var a;const o=null!==(a=e.log)&&void 0!==a?a:[],n=(new Date).getTime();return{...e,log:t.payload.reset?[{level:"error",content:t.payload.msg,timestamp:n}]:[...o,{level:"error",content:t.payload.msg,timestamp:n}]}},logInfo:(e,t)=>{var a;const o=null!==(a=e.log)&&void 0!==a?a:[],n=(new Date).getTime();return{...e,log:t.payload.reset?[{level:"info",content:t.payload.msg,timestamp:n}]:[...o,{level:"info",content:t.payload.msg,timestamp:n}]}},logExecution:(e,t)=>{var a;const o=null!==(a=e.log)&&void 0!==a?a:[],n=(new Date).getTime();if(t.payload.length>o.length){const a=[...o];for(let e=o.length;e<t.payload.length;e++){const o=t.payload[e];let l="";const s=o.comment?` - ${o.comment}`:"";switch(o.type){case"JobLevel":l=`${o.type} - ${o.job_state.new}${s}`;break;case"ExecutionLevel":l=`${o.type} - ${o.execution_state.new}${s}`}a.push({level:"info",content:l,timestamp:n})}return{...e,log:a}}return{...e}},togglePolling:(e,t)=>({...e,polling:t.payload.startPolling}),stopPolling:e=>({...e,polling:!1}),updateResultStatus:(e,t)=>({...e,resultAvailable:t.payload}),updateJobId:(e,t)=>({...e,jobId:t.payload})}}),b=(e,t)=>e.resources[t],w=f.actions,y=f.reducer;async function C(e){return await l("",{method:"POST",body:JSON.stringify({action:"CLEAN_JOB",payload:{jobId:e}})})}function E(){let e;return t=>a=>o=>{if(!w.togglePolling.match(o))return a(o);const{startPolling:n,sessionId:s,jobId:r}=o.payload;return t.getState().polling===n&&a(o),n&&s&&r&&!e?e=setInterval((async()=>{const a=await async function(e,t){return await l("",{method:"POST",body:JSON.stringify({action:"GET_STATE",payload:{sessionId:e,jobId:t}})})}(s,r);if("GET_STATE"===a.action){const{state:o,log:n}=a.payload,l=n;if("Completed"!==o&&"Error"!==o)t.dispatch(w.logExecution(l.events));else if("Completed"===o){clearInterval(e),e=null,t.dispatch(w.stopPolling()),t.dispatch(w.logExecution(l.events)),t.dispatch(w.logInfo({msg:`Job ${r} finished`}));const a=await C(r);1!==a.payload&&t.dispatch(w.logError({msg:`Failed to clean job ${r}: ${a.payload}`})),t.dispatch(w.updateResultStatus(!0)),t.dispatch(w.updateJobId(r))}else if("Error"===o){clearInterval(e),e=null,t.dispatch(w.stopPolling()),t.dispatch(w.logExecution(l.events)),t.dispatch(w.logError({msg:`Job ${r} failed`}));const a=await C(r);1!==a.payload&&t.dispatch(w.logError({msg:`Failed to clean job ${r}: ${a.payload}`}))}}}),1e3):(t.dispatch(w.stopPolling()),clearInterval(e),e=null),a(o)}}(0,g.configureStore)({reducer:y});var x=a(3379),S=a.n(x),I=a(7795),k=a.n(I),M=a(569),z=a.n(M),D=a(3565),V=a.n(D),T=a(9216),L=a.n(T),B=a(4589),R=a.n(B),P=a(3606),Z={};Z.styleTagTransform=R(),Z.setAttributes=V(),Z.insert=z().bind(null,"head"),Z.domAPI=k(),Z.insertStyleElement=L(),S()(P.Z,Z),P.Z&&P.Z.locals&&P.Z.locals;var O=a(6319),H=a(9605),N=a(7858),A=a(9206),F=a(7965),j=a(9487),J=a(3972),K=a(3508);function W(e){return p.createElement(O.Box,{sx:{"& .MuiAccordion-root":{margin:"8px 0px!important"},"& .MuiAccordionSummary-content.Mui-expanded":{margin:"12px 0!important"}}},p.createElement(O.Accordion,{sx:{"& .MuiAccordionSummary-root.Mui-expanded":{minHeight:"40px"},"& .MuiAccordionSummary-root":{borderBottom:"solid 1px #ddd"}},defaultExpanded:e.defaultExpanded},p.createElement(O.AccordionSummary,{expandIcon:p.createElement(K.Z,null)},p.createElement(O.Typography,{variant:"body2"},e.title)),p.createElement(O.AccordionDetails,null,e.panel)))}var $=a(3640),U=a(76),G=a(3931),Y=a(4509),Q=a(5722);const q=_.useDispatch,X=_.useSelector;function ee(e){var t,a,o,n,s,r,i;const c=q(),d=X((e=>e.dockerImage)),u=X((e=>e.sessionId)),m=X((e=>e.availableImages)),h=X((e=>e.customDockerImage)),_=p.useCallback((e=>{c(w.setCustomDockerImage(e))}),[c]),g=p.useCallback((e=>{const t=e.target.value;c(w.setDockerImage(t)),"local-image"!==t&&c(w.setCustomDockerImage(""))}),[c]),v=p.useCallback((async()=>{if(!h||0===h.length)return;c(w.logInfo({msg:`Adding ${h} image`}));const e=await l("",{method:"POST",body:JSON.stringify({action:"CUSTOM_IMAGE",payload:{sessionId:u,customDockerImage:h}})}),{success:t,msg:a}=e.payload;t?(c(w.addCustomDockerImage(h)),c(w.logInfo({msg:`Image ${h} added successfully`}))):c(w.logError({msg:`Failed to add Image ${h}: ${a}`}))}),[h,u,c]);return p.createElement(O.Stack,{spacing:2,className:"jp-deai-general-setting"},p.createElement(O.Typography,{sx:{fontSize:"0.85rem"}},"Please select the Docker image which you want the Bacalhau node to use to run your code in."),p.createElement($.Z,{sx:{width:"100%"},size:"small",error:"dockerSelector"===(null===(t=e.error)||void 0===t?void 0:t.el)},p.createElement(U.Z,{id:"demo-simple-select-helper-label",sx:{fontSize:"0.9rem"}},"Select docker image"),p.createElement(Q.Z,{labelId:"demo-simple-select-helper-label",id:"demo-simple-select-helper",value:null!=d?d:"",label:"Select docker image",fullWidth:!0,sx:{"& .MuiInputBase-inputSizeSmall":{fontSize:"0.9rem"}},onChange:g},m.map(((e,t)=>p.createElement(G.Z,{key:e+t,value:e},e))),p.createElement(G.Z,{value:"local-image"},"Custom image")),p.createElement(Y.Z,null,"dockerSelector"===(null===(a=e.error)||void 0===a?void 0:a.el)&&null!==(n=null===(o=e.error)||void 0===o?void 0:o.msg)&&void 0!==n?n:"")),p.createElement(O.Box,{sx:{display:"local-image"!==d?"none":"flex",flexDirection:"row",gap:"5px"}},p.createElement(O.TextField,{InputLabelProps:{shrink:!0},size:"small",onChange:e=>_(e.target.value),label:"local-image"!==d?"Disabled":"Custom image",placeholder:"Docker image name",disabled:"local-image"!==d,sx:{"& .MuiInputBase-inputSizeSmall":{fontSize:"0.9rem"},"& .MuiInputLabel-sizeSmall":{fontSize:"0.9rem"},flexGrow:1},value:h,error:"customImage"===(null===(s=e.error)||void 0===s?void 0:s.el),helperText:null!==(i=null===(r=e.error)||void 0===r?void 0:r.msg)&&void 0!==i?i:""}),p.createElement(O.Button,{sx:{minWidth:100},variant:"outlined",onClick:v},"Add")))}const te=(0,a(948).ZP)(O.TextField)({"& .MuiInputBase-inputSizeSmall":{fontSize:"0.9rem"},"& .MuiInputLabel-sizeSmall":{fontSize:"0.9rem"}});function ae(e){const{resourceId:t,error:a}=e,o=X((e=>b(e,t))),n=q(),l=p.useCallback((e=>{n(w.updateResource({id:t,resource:e}))}),[n,t]),s=p.useMemo((()=>{let e="";switch(o.type){case"ipfs":e="IPFS ID";break;case"file":e="Path to resource";break;case"url":e="URL"}return e}),[o]),r=p.useCallback((()=>{n(w.removeResource(t))}),[n,t]);return p.createElement(O.Stack,{direction:"row",spacing:2},p.createElement(O.FormControl,{sx:{width:"20%"},size:"small"},p.createElement(O.InputLabel,null,"Resource type"),p.createElement(O.Select,{value:o.type,label:"Resource type",sx:{"& .MuiInputBase-inputSizeSmall":{fontSize:"0.9rem"}},fullWidth:!0,onChange:e=>{l({type:e.target.value})},size:"small"},p.createElement(O.MenuItem,{value:"file"},"File/Directory"),p.createElement(O.MenuItem,{value:"url"},"URL"),p.createElement(O.MenuItem,{value:"ipfs"},"IPFS"))),p.createElement(O.FormControl,{size:"small",sx:{width:"50%"}},p.createElement(te,{value:o.value,size:"small",label:s,sx:{"& .MuiFileInput-placeholder":{fontSize:"0.9rem"}},fullWidth:!0,onChange:e=>{l({value:e.target.value})},error:Boolean(a),helperText:a})),p.createElement(O.FormControl,{sx:{width:"15%"},size:"small"},p.createElement(O.InputLabel,null,"Encrypt data"),p.createElement(O.Select,{value:o.encryption?1:0,label:"Encrypt data",sx:{"& .MuiInputBase-inputSizeSmall":{fontSize:"0.9rem"}},fullWidth:!0,onChange:e=>{l({encryption:Boolean(e.target.value)})},size:"small"},p.createElement(O.MenuItem,{value:1},"Yes"),p.createElement(O.MenuItem,{value:0},"No"))),p.createElement(O.Button,{variant:"outlined",color:"warning",size:"small",sx:{width:"15%",maxHeight:"40px"},onClick:r},"Remove"))}function oe(e){const t=X((e=>e.resources)),a=q(),o=p.useCallback((()=>{const e=i.UUID.uuid4();a(w.addResource(e))}),[a]);return p.createElement(O.Stack,{spacing:2,className:"jp-deai-resource-setting"},p.createElement(J.Z,{sx:{fontSize:"0.85rem"}},"Your code will be run on a remote Bacalhau node which does not allow downloading data or packages. As such please include all data sources your code needs to have access to. They will be made available in the directory /inputs."),Object.keys(null!=t?t:{}).map((t=>p.createElement(ae,{key:t,resourceId:t,error:e.error[t]}))),p.createElement(O.Box,{sx:{width:"100%",display:"flex",justifyContent:"center"}},p.createElement(O.Button,{variant:"outlined",onClick:o},"Add resource")))}const ne=p.createContext({themeManager:void 0,serviceManager:void 0,context:void 0}),le=()=>p.useContext(ne);var se=a(7349),re=a(6797);function ie(){const e=le(),t=X((e=>e)),{dockerImage:a,customDockerImage:o}=t,[n,r]=p.useState({}),[i,c]=p.useState(!1),[d,u]=p.useState(null),m=q(),h=X((e=>e.polling)),_=X((e=>e.sessionId)),g=X((e=>e.jobId)),v=X((e=>e.deaiFileName)),f=X((e=>e.cwd)),b=X((e=>e.resultAvailable));p.useEffect((()=>()=>{m(w.togglePolling({startPolling:!1}))}),[m]),p.useEffect((()=>{h||c(!1)}),[h,c]),p.useEffect((()=>{(a&&"local-image"!==a||"local-image"===a&&o&&o.length>0)&&u(null)}),[a,o]);const y=p.useCallback((async()=>{const{context:a,serviceManager:o}=e;if(!a||!o)return;const n=a.path,l=await o.contents.get(n);await o.contents.save(a.path,{...l,content:JSON.stringify(t,null,2)})}),[e,t]),C=p.useCallback((async()=>{if(i)return;if(!a||0===a.length)return void u({el:"dockerSelector",msg:"Missing image"});if("local-image"===a&&(!o||0===o.length))return void u({el:"customImage",msg:"Missing image"});const{context:n,serviceManager:d}=e;if(!n||!d)return;const h=n.path,p=await d.contents.get(h),_=h.replace(".bhl.deai",".ipynb");let g=null;try{g=await d.contents.get(_)}catch(e){return void await(0,s.showDialog)({title:"Missing notebook",body:`The notebook ${_} is missing`,buttons:[s.Dialog.okButton()]})}const v=JSON.parse(JSON.stringify(t));delete v.log,g&&(v.notebook=g.content),await d.contents.save(n.path,{...p,content:JSON.stringify(v,null,2)}),m(w.logInfo({msg:`Submitting job ${h}`,reset:!0})),m(w.updateJobId(void 0)),m(w.updateResultStatus(!1)),c(!0);const f=await l("",{method:"POST",body:JSON.stringify({action:"EXECUTE",payload:v})}),{action:b,payload:y}=f,C=t.sessionId;switch(b){case"RESOURCE_ERROR":{const e={};Object.entries(y).forEach((([t,a])=>{(null==a?void 0:a.validated)||(e[t]=null==a?void 0:a.message)})),m(w.logError({msg:"Resource Error!"})),r(e),c(!1);break}case"EXECUTING":{const{jobId:e}=y;m(w.logInfo({msg:`Executing job with id ${e}`})),m(w.togglePolling({startPolling:!0,sessionId:C,jobId:e}));break}}}),[e,t,a,o,m,i]),E=p.useCallback((async()=>{if(!b)return;const e=await l("",{method:"POST",body:JSON.stringify({action:"DOWNLOAD_RESULT",payload:{sessionId:_,jobId:g,currentDir:f,deaiFileName:v}})});if(e.payload.success){m(w.logInfo({msg:e.payload.msg}));const t=new re.Poll({frequency:{interval:1e3},factory:async()=>{const a=await async function(e){return(await l("",{method:"POST",body:JSON.stringify({action:"CHECK_DOWNLOAD_STATUS",payload:{taskId:e}})})).payload.status}(e.payload.task_id);"finished"===a?(t.stop(),m(w.logInfo({msg:"Result downloaded successfully"}))):"error"===a?(t.stop(),m(w.logError({msg:"Failed to download result"}))):"pending"===a&&m(w.logInfo({msg:"Download in progress"}))}});t.start()}else m(w.logError({msg:e.payload.msg}));m(w.updateResultStatus(!1))}),[m,b,g,f,_,v]);return p.createElement(O.Box,{className:"jp-deai-control-panel"},p.createElement(A.Z,{position:"static",sx:{marginBottom:"20px"}},p.createElement(J.Z,{variant:"h6",component:"div",sx:{flexGrow:1,paddingLeft:"10px"}},"DeAI Request")),p.createElement(O.Container,{maxWidth:"md",sx:{flexGrow:1,overflow:"auto"}},p.createElement(W,{title:"DOCKER IMAGE",panel:p.createElement(ee,{error:d}),defaultExpanded:!0}),p.createElement(W,{title:"DATA SOURCES",panel:p.createElement(oe,{error:n}),defaultExpanded:!0})),p.createElement(O.Card,{elevation:5},p.createElement(F.Z,{showLabels:!0},p.createElement(j.Z,{label:"SAVE",icon:p.createElement(N.Save,{color:"warning"}),onClick:y,sx:{display:"none"}}),p.createElement(j.Z,{color:"primary",label:"RUN",onClick:C,icon:i?p.createElement(se.Z,{color:"primary"}):p.createElement(N.PlayCircle,{color:"primary"})}),p.createElement(j.Z,{color:b?"primary":"disabled",disabled:!b,label:"GET RESULT",icon:p.createElement(N.Download,{color:b?"primary":"disabled"}),onClick:E}))))}function ce(){const e=X((e=>e.log)),t=p.useRef();return p.useEffect((()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)}),[e]),p.createElement(O.Box,{className:"jp-LogConsolePanel",sx:{overflow:"auto",height:"100%"},ref:t},0===(null!=e?e:[]).length&&p.createElement("div",{className:"jp-LogConsoleListPlaceholder"},"No log messages."),e&&e.map(((e,t)=>p.createElement(O.Box,{key:t,sx:{display:"flex"}},p.createElement("div",{className:"lm-Widget jp-OutputArea-prompt jp-deai-logTimestamp","data-log-level":e.level},p.createElement("div",null,new Date(e.timestamp).toLocaleTimeString())),p.createElement("p",{className:"jp-deai-logLine"},e.content)))))}function de(){return p.createElement(O.Box,{component:"div",className:"jp-deai-main"},p.createElement(H.Allotment,{onChange:e=>{window.dispatchEvent(new Event("resize"))},defaultSizes:[60,40]},p.createElement(H.Allotment.Pane,{snap:!1,minSize:300},p.createElement(ie,null)),p.createElement(H.Allotment.Pane,{snap:!1,minSize:300},p.createElement(ce,null))))}var ue=a(1893),me=a(2233);const he=p.createContext({toggleColorMode:()=>{throw new Error("Component is not wrapped with a ColorModeProvider.")}});function pe(e){return e?"JupyterLab Light"===e.theme?"light":"dark":"light"}function _e(e){const t=le(),{themeManager:a}=t,o=pe(a),[n,l]=p.useState(o);p.useEffect((()=>{var e;const t=()=>{l(pe(a))};return null===(e=null==a?void 0:a.themeChanged)||void 0===e||e.connect(t),()=>{var e;null===(e=null==a?void 0:a.themeChanged)||void 0===e||e.disconnect(t)}}),[a]);const s=p.useMemo((()=>({toggleColorMode:()=>{l((e=>"light"===e?"dark":"light"))}})),[]),r=p.useMemo((()=>(0,ue.Z)({palette:{mode:n}})),[n]);return p.createElement(he.Provider,{value:s},p.createElement(me.Z,{theme:r},e.children))}class ge extends s.ReactWidget{constructor(e){super(),this.options=e,this.addClass("jp-deai-panel"),this._store=(0,g.configureStore)({reducer:y,middleware:e=>e().concat([E()])}),this.options.context.ready.then((async()=>{const e=this.options.context.model.toJSON(),t=e.protocol,a=await l("",{method:"POST",body:JSON.stringify({action:"CREATE_SESSION",payload:t})});e.sessionId=a.payload.sessionId,e.availableImages=a.payload.availableImages,this._store.dispatch(w.load(e))}))}dispose(){this._store.dispatch(w.reset()),super.dispose()}render(){return p.createElement(ne.Provider,{value:{themeManager:this.options.themeManager,serviceManager:this.options.serviceManager,context:this.options.context}},p.createElement(_.Provider,{store:this._store},p.createElement(_e,null,p.createElement(de,null))))}}class ve extends h.DocumentWidget{constructor(){super(...arguments),this.onResize=e=>{window.dispatchEvent(new Event("resize"))}}}class fe extends h.ABCWidgetFactory{constructor(e){super(e),this._commands=e.commands,this._themeManager=e.themeManager,this._serviceManager=e.serviceManager}get commands(){return this._commands}createNewWidget(e){const t=new ge({context:e,themeManager:this._themeManager,serviceManager:this._serviceManager}),a=new ve({context:e,content:t});return a.title.icon=m,a}}const be={id:"bhl-lab:document-plugin",autoStart:!0,provides:c,requires:[r.IRenderMimeRegistry],optional:[s.IThemeManager],activate:(e,t,a)=>{const o=new s.WidgetTracker({namespace:"bhl-lab:widgets"}),n=new fe({name:"DeAI",fileTypes:["deai"],defaultFor:["deai"],rendermime:t,commands:e.commands,themeManager:a,serviceManager:e.serviceManager});return n.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{o.save(t)})),o.add(t)})),e.docRegistry.addWidgetFactory(n),e.docRegistry.addFileType({name:"deai",icon:m,displayName:"DEAI",mimeTypes:["text/json"],extensions:[".deai",".DEAI"],fileFormat:"json",contentType:"file"}),o}};var we,ye=a(4163),Ce=a(1919),Ee=a(56);class xe extends u.ReactWidget{constructor(e,t){super(),this.handleChange=e=>{const t=e.target.value;this._commands.execute("notebook:open-with-bhl",{protocol:t,ext:this._serverData.availableProtocol[t].ext}),this.update()},this.handleKeyDown=e=>{},this._commands=t,this._serverData=e,this.addClass("jp-Notebook-toolbarCellType")}render(){return p.createElement(u.HTMLSelect,{className:"jp-Notebook-toolbarCellTypeDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,"aria-label":"DeAI Selector",title:"DeAI Protocol",value:"DeAI"},p.createElement("option",{value:"DeAI"},"Run in..."),Object.entries(this._serverData.availableProtocol).map((([e,t])=>p.createElement("option",{value:e,key:e},e))))}}!function(e){e.bhlOpen="notebook:open-with-bhl"}(we||(we={}));class Se{constructor(e,t){this._commands=t,this._serverData=e}createNew(e){const t=new xe(this._serverData,this._commands);return e.toolbar.insertAfter("cellType","bhlLab",t),t}}const Ie=[{id:"deailab:plugin",description:"A JupyterLab extension for DeAI.",autoStart:!0,provides:d,activate:e=>{console.log("JupyterLab extension deailab is activated!");const t={availableProtocol:{}};return l().then((e=>{t.availableProtocol=e.payload.availableProtocol})).catch((e=>{console.error(`The deailab server extension appears to be missing.\n${e}`)})),t}},be,{id:"deailab:toolbar-plugin",autoStart:!0,requires:[d],optional:[Ce.INotebookTracker,s.ICommandPalette,ye.ILayoutRestorer,Ee.ISettingRegistry],activate:(e,t,a)=>{const{commands:n,docRegistry:s}=e;n.addCommand(we.bhlOpen,{label:"Open in Bacalhau Lab",execute:async s=>{const r=function(t){var o;const n=null!==(o=null==a?void 0:a.currentWidget)&&void 0!==o?o:null;return!1!==t.activate&&n&&e.shell.activateById(n.id),n}(s);if(r){const a=r.context.path,c=o.PathExt.basename(a).replace(o.PathExt.extname(a),""),d=r.context.model.toJSON(),u=s.protocol,m=s.ext,h=o.PathExt.dirname(a),p=`${c}.${m}`;let _=o.PathExt.join(h,`${p}.deai`);const g=await l("",{method:"POST",body:JSON.stringify({action:"PARSE_RESOURCES",payload:{nbContent:d,currentPath:h}})}),v={};g.resources.forEach((e=>{v[i.UUID.uuid4()]=e}));try{const a=await e.serviceManager.contents.get(_),o=JSON.parse(a.content);_=a.path,o.protocol=u,o.availableImage=t.availableProtocol[u].availableImages,o.notebook=d,o.resources=v,o.cwd=g.cwd,o.deaiFileName=p;const n=JSON.stringify(o);await e.serviceManager.contents.save(_,{...a,content:n})}catch(t){const a=await e.serviceManager.contents.newUntitled({path:h,type:"file",ext:".deai"}),o={protocol:u,availableImages:[],resources:v,notebook:d,cwd:g.cwd,deaiFileName:p};await e.serviceManager.contents.save(a.path,{...a,format:"text",size:void 0,content:JSON.stringify(o,void 0,2)}),await e.serviceManager.contents.rename(a.path,_)}n.execute("docmanager:open",{path:_})}},isEnabled:function(){return null!==(null==a?void 0:a.currentWidget)&&(null==a?void 0:a.currentWidget)===e.shell.currentWidget}});const r=new Se(t,n);s.addWidgetExtension("Notebook",r)}}]},5318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},3508:(e,t,a)=>{"use strict";var o=a(5318);t.Z=void 0;var n=o(a(4938)),l=a(5893),s=(0,n.default)((0,l.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");t.Z=s},7349:(e,t,a)=>{"use strict";var o=a(5318);t.Z=void 0;var n=o(a(4938)),l=a(5893),s=(0,n.default)((0,l.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"}),"PauseCircle");t.Z=s},4938:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.createSvgIcon}});var o=a(4040)},3606:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var o=a(8081),n=a.n(o),l=a(3645),s=a.n(l)()(n());s.push([e.id,':root {\n  --separator-border: rgba(128, 128, 128, 0.35);\n}\n\n.allotment-module_splitView__L-yRc {\n  height: 100%;\n  overflow: hidden;\n  position: relative;\n  width: 100%;\n}\n\n.allotment-module_splitView__L-yRc > .allotment-module_sashContainer__fzwJF {\n  height: 100%;\n  pointer-events: none;\n  position: absolute;\n  width: 100%;\n}\n\n.allotment-module_splitView__L-yRc > .allotment-module_sashContainer__fzwJF > .allotment-module_sash__QA-2t {\n  pointer-events: auto;\n}\n\n.allotment-module_splitView__L-yRc > .allotment-module_splitViewContainer__rQnVa {\n  height: 100%;\n  position: relative;\n  white-space: nowrap;\n  width: 100%;\n}\n\n.allotment-module_splitView__L-yRc > .allotment-module_splitViewContainer__rQnVa > .allotment-module_splitViewView__MGZ6O {\n  overflow: hidden;\n  position: absolute;\n  white-space: initial;\n}\n\n.allotment-module_splitView__L-yRc.allotment-module_vertical__WSwwa > .allotment-module_splitViewContainer__rQnVa > .allotment-module_splitViewView__MGZ6O {\n  width: 100%;\n}\n\n.allotment-module_splitView__L-yRc.allotment-module_horizontal__7doS8 > .allotment-module_splitViewContainer__rQnVa > .allotment-module_splitViewView__MGZ6O {\n  height: 100%;\n}\n\n.allotment-module_splitView__L-yRc.allotment-module_separatorBorder__x-rDS\n  > .allotment-module_splitViewContainer__rQnVa\n  > .allotment-module_splitViewView__MGZ6O:not(:first-child)::before {\n  background-color: var(--separator-border);\n  content: " ";\n  left: 0;\n  pointer-events: none;\n  position: absolute;\n  top: 0;\n  z-index: 5;\n}\n\n.allotment-module_splitView__L-yRc.allotment-module_separatorBorder__x-rDS.allotment-module_vertical__WSwwa\n  > .allotment-module_splitViewContainer__rQnVa\n  > .allotment-module_splitViewView__MGZ6O:not(:first-child)::before {\n  height: 1px;\n  width: 100%;\n}\n\n.allotment-module_splitView__L-yRc.allotment-module_separatorBorder__x-rDS.allotment-module_horizontal__7doS8\n  > .allotment-module_splitViewContainer__rQnVa\n  > .allotment-module_splitViewView__MGZ6O:not(:first-child)::before {\n  height: 100%;\n  width: 1px;\n}\n\n:root {\n  --focus-border: #007fd4;\n  --sash-size: 8px;\n  --sash-hover-size: 4px;\n}\n\n.sash-module_sash__K-9lB {\n  position: absolute;\n  z-index: 35;\n  touch-action: none;\n  pointer-events: auto;\n  text-align: initial;\n}\n\n.sash-module_sash__K-9lB.sash-module_disabled__Hm-wx {\n  pointer-events: none;\n}\n\n.sash-module_sash__K-9lB.sash-module_mac__Jf6OJ.sash-module_vertical__pB-rs {\n  cursor: col-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_vertical__pB-rs.sash-module_minimum__-UKxp {\n  cursor: e-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_vertical__pB-rs.sash-module_maximum__TCWxD {\n  cursor: w-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_mac__Jf6OJ.sash-module_horizontal__kFbiw {\n  cursor: row-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw.sash-module_minimum__-UKxp {\n  cursor: s-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw.sash-module_maximum__TCWxD {\n  cursor: n-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_disabled__Hm-wx {\n  cursor: default !important;\n  pointer-events: none !important;\n}\n\n.sash-module_sash__K-9lB.sash-module_vertical__pB-rs {\n  cursor: ew-resize;\n  top: 0;\n  width: var(--sash-size);\n  height: 100%;\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw {\n  cursor: ns-resize;\n  left: 0;\n  width: 100%;\n  height: var(--sash-size);\n}\n\n.sash-module_sash__K-9lB:not(.sash-module_disabled__Hm-wx) > .sash-module_orthogonal-drag-handle__Yii2- {\n  content: " ";\n  height: calc(var(--sash-size) * 2);\n  width: calc(var(--sash-size) * 2);\n  z-index: 100;\n  display: block;\n  cursor: all-scroll;\n  position: absolute;\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw.sash-module_orthogonal-edge-north__f7Noe:not(.sash-module_disabled__Hm-wx)\n  > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_start__uZEDk,\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw.sash-module_orthogonal-edge-south__6ZrFC:not(.sash-module_disabled__Hm-wx)\n  > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_end__0TP-R {\n  cursor: nwse-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw.sash-module_orthogonal-edge-north__f7Noe:not(.sash-module_disabled__Hm-wx)\n  > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_end__0TP-R,\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw.sash-module_orthogonal-edge-south__6ZrFC:not(.sash-module_disabled__Hm-wx)\n  > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_start__uZEDk {\n  cursor: nesw-resize;\n}\n\n.sash-module_sash__K-9lB.sash-module_vertical__pB-rs > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_start__uZEDk {\n  left: calc(var(--sash-size) * -0.5);\n  top: calc(var(--sash-size) * -1);\n}\n\n.sash-module_sash__K-9lB.sash-module_vertical__pB-rs > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_end__0TP-R {\n  left: calc(var(--sash-size) * -0.5);\n  bottom: calc(var(--sash-size) * -1);\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_start__uZEDk {\n  top: calc(var(--sash-size) * -0.5);\n  left: calc(var(--sash-size) * -1);\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw > .sash-module_orthogonal-drag-handle__Yii2-.sash-module_end__0TP-R {\n  top: calc(var(--sash-size) * -0.5);\n  right: calc(var(--sash-size) * -1);\n}\n\n.sash-module_sash__K-9lB:before {\n  content: "";\n  pointer-events: none;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  transition: background-color 0.1s ease-out;\n  background: transparent;\n}\n\n.sash-module_sash__K-9lB.sash-module_vertical__pB-rs:before {\n  width: var(--sash-hover-size);\n  left: calc(50% - (var(--sash-hover-size) / 2));\n}\n\n.sash-module_sash__K-9lB.sash-module_horizontal__kFbiw:before {\n  height: var(--sash-hover-size);\n  top: calc(50% - (var(--sash-hover-size) / 2));\n}\n\n.sash-module_sash__K-9lB.sash-module_hover__80W6I:before,\n.sash-module_sash__K-9lB.sash-module_active__bJspD:before {\n  background: var(--focus-border);\n}\n',""]);const r=s},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",o=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),o&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),o&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,o,n,l){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var r=0;r<this.length;r++){var i=this[r][0];null!=i&&(s[i]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==l&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=l),a&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=a):d[2]=a),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),t.push(d))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},3379:e=>{"use strict";var t=[];function a(e){for(var a=-1,o=0;o<t.length;o++)if(t[o].identifier===e){a=o;break}return a}function o(e,o){for(var l={},s=[],r=0;r<e.length;r++){var i=e[r],c=o.base?i[0]+o.base:i[0],d=l[c]||0,u="".concat(c," ").concat(d);l[c]=d+1;var m=a(u),h={css:i[1],media:i[2],sourceMap:i[3],supports:i[4],layer:i[5]};if(-1!==m)t[m].references++,t[m].updater(h);else{var p=n(h,o);o.byIndex=r,t.splice(r,0,{identifier:u,updater:p,references:1})}s.push(u)}return s}function n(e,t){var a=t.domAPI(t);return a.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,n){var l=o(e=e||[],n=n||{});return function(e){e=e||[];for(var s=0;s<l.length;s++){var r=a(l[s]);t[r].references--}for(var i=o(e,n),c=0;c<l.length;c++){var d=a(l[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}l=i}}},569:e=>{"use strict";var t={};e.exports=function(e,a){var o=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(a)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,a)=>{"use strict";e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var o="";a.supports&&(o+="@supports (".concat(a.supports,") {")),a.media&&(o+="@media ".concat(a.media," {"));var n=void 0!==a.layer;n&&(o+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),o+=a.css,n&&(o+="}"),a.media&&(o+="}"),a.supports&&(o+="}");var l=a.sourceMap;l&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}}]);